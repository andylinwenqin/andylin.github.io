<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>声网视频和音频的学习 | Andylin's Blog</title><meta name="keywords" content="工作积累"><meta name="author" content="林文钦,andylin0119@163.com"><meta name="copyright" content="林文钦"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="声网 产品概述Agora 互动直播（Interactive Live Streaming Premium）可以实现一对多，多对多的音视频互动直播。 Agora 互动直播不同于视频通话。视频通话不区分主播和观众，所有用户都可以发言并看见彼此；互动直播的用户分为主播和观众，只有主播可以自由发言，且被其他用户看见。详见通信和直播场景有什么区别。 加入和离开频道Agora Web SDK 使用 [Agor">
<meta property="og:type" content="article">
<meta property="og:title" content="声网视频和音频的学习">
<meta property="og:url" content="https://andylinwenqin.github.io/2021/08/09/%E5%A3%B0%E7%BD%91%E8%A7%86%E9%A2%91%E5%92%8C%E9%9F%B3%E9%A2%91%E7%9A%84%E5%AD%A6%E4%B9%A0/index.html">
<meta property="og:site_name" content="Andylin&#39;s Blog">
<meta property="og:description" content="声网 产品概述Agora 互动直播（Interactive Live Streaming Premium）可以实现一对多，多对多的音视频互动直播。 Agora 互动直播不同于视频通话。视频通话不区分主播和观众，所有用户都可以发言并看见彼此；互动直播的用户分为主播和观众，只有主播可以自由发言，且被其他用户看见。详见通信和直播场景有什么区别。 加入和离开频道Agora Web SDK 使用 [Agor">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://andylinwenqin.github.io/img/2.jpg">
<meta property="article:published_time" content="2021-08-09T15:20:23.000Z">
<meta property="article:modified_time" content="2021-08-09T16:23:08.939Z">
<meta property="article:author" content="林文钦">
<meta property="article:tag" content="工作积累">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://andylinwenqin.github.io/img/2.jpg"><link rel="shortcut icon" href="/andylin.github.io/img/favicon.png"><link rel="canonical" href="https://andylinwenqin.github.io/2021/08/09/%E5%A3%B0%E7%BD%91%E8%A7%86%E9%A2%91%E5%92%8C%E9%9F%B3%E9%A2%91%E7%9A%84%E5%AD%A6%E4%B9%A0/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/andylin.github.io/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/andylin.github.io/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '声网视频和音频的学习',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-08-10 00:23:08'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    })(window)</script><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/andylin.github.io/atom.xml" title="Andylin's Blog" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="/andylin.github.io/img/OIP-C.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/andylin.github.io/archives/"><div class="headline">文章</div><div class="length-num">46</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/andylin.github.io/tags/"><div class="headline">标签</div><div class="length-num">15</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/andylin.github.io/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/andylin.github.io/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/andylin.github.io/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/andylin.github.io/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/andylin.github.io/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/andylin.github.io/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/andylin.github.io/img/2.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/andylin.github.io/">Andylin's Blog</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/andylin.github.io/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/andylin.github.io/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/andylin.github.io/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/andylin.github.io/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/andylin.github.io/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/andylin.github.io/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">声网视频和音频的学习</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-08-09T15:20:23.000Z" title="发表于 2021-08-09 23:20:23">2021-08-09</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-08-09T16:23:08.939Z" title="更新于 2021-08-10 00:23:08">2021-08-10</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="声网视频和音频的学习"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="声网"><a href="#声网" class="headerlink" title="声网"></a><a target="_blank" rel="noopener" href="https://www.agora.io/cn">声网</a></h1><hr>
<h2 id="产品概述"><a href="#产品概述" class="headerlink" title="产品概述"></a>产品概述</h2><p>Agora 互动直播（Interactive Live Streaming Premium）可以实现一对多，多对多的音视频互动直播。</p>
<p>Agora 互动直播不同于视频通话。视频通话不区分主播和观众，所有用户都可以发言并看见彼此；互动直播的用户分为主播和观众，只有主播可以自由发言，且被其他用户看见。详见<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/faq/profile_difference">通信和直播场景有什么区别</a>。</p>
<h2 id="加入和离开频道"><a href="#加入和离开频道" class="headerlink" title="加入和离开频道"></a>加入和离开频道</h2><p>Agora Web SDK 使用 [AgoraRTCClient](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/iagorartcclient.html) 对象来管理一个本地用户在目标频道内的行为。在加入目标频道之前，你需要先创建一个 <code>AgoraRTCClient</code> 对象。</p>
<h3 id="创建-AgoraRTCClient-对象"><a href="#创建-AgoraRTCClient-对象" class="headerlink" title="创建 AgoraRTCClient 对象"></a>创建 AgoraRTCClient 对象</h3><p>调用 [AgoraRTC.createClient](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/iagorartc.html#createclient) 即可创建 <code>AgoraRTCClient</code> 对象。在创建 <code>AgoraRTCClient</code> 时，你需要指定使用的编码格式（<code>codec</code>）以及频道场景（<code>mode</code>）。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> client = AgoraRTC.createClient(&#123;</span><br><span class="line">  <span class="attr">codec</span>: <span class="string">&quot;vp8&quot;</span>,</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;rtc&quot;</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="选择视频编码格式"><a href="#选择视频编码格式" class="headerlink" title="选择视频编码格式"></a>选择视频编码格式</h3><p><code>codec</code> 设置支持 <code>&quot;vp8&quot;</code>（VP8）和 <code>&quot;h264&quot;</code>（H.264）两种视频编码格式。该设置只会影响发布端的视频编码格式，对于订阅端来说只要其支持该格式的解码，都能正常完成订阅。</p>
<p>举例来说，桌面端 Chrome 58 及以上版本既支持 VP8 也支持 H.264，而 Safari 12.1 以下版本不支持 VP8 编解码；如果频道中有两个主播分别发布了 VP8 和 H.264 的视频流，使用桌面端 Chrome 58 的观众可以解码这两个主播的视频，使用 Safari 12.1 以下版本浏览器的观众只能解码 H.264 的视频流。</p>
<p>不同浏览器和不同设备对这两种编解码格式支持都不同。下表列出不同浏览器所支持的编解码格式作为参考：</p>
<table>
<thead>
<tr>
<th align="left">浏览器</th>
<th align="left">VP8</th>
<th align="left">H.264</th>
</tr>
</thead>
<tbody><tr>
<td align="left">桌面端 Chrome 58+</td>
<td align="left">✔</td>
<td align="left">✔</td>
</tr>
<tr>
<td align="left">Firefox 56+</td>
<td align="left">✔</td>
<td align="left">✔*</td>
</tr>
<tr>
<td align="left">Safari 12.1+</td>
<td align="left">✔</td>
<td align="left">✔</td>
</tr>
<tr>
<td align="left">Safari &lt; 12.1</td>
<td align="left">✘</td>
<td align="left">✔</td>
</tr>
<tr>
<td align="left">Android Chrome 58+</td>
<td align="left">✔</td>
<td align="left">?*</td>
</tr>
</tbody></table>
<h3 id="选择频道场景"><a href="#选择频道场景" class="headerlink" title="选择频道场景"></a>选择频道场景</h3><p>频道场景（<code>mode</code>）是 Agora 为了对不同的实时音视频场景进行针对性算法优化而提供的一种设置选项。SDK 支持两种频道场景：<code>&quot;rtc&quot;</code>（通信场景） 和 <code>&quot;live&quot;</code>（直播场景）。</p>
<p><strong>通信场景</strong></p>
<p><code>&quot;rtc&quot;</code>（通信场景）适用于频道内所有用户需要相互交流且用户总数不太多的场景，如多人会议和在线聊天。</p>
<p><strong>直播场景</strong></p>
<p><code>&quot;live&quot;</code>（直播场景）适用于发布端很少但是订阅端很多的场景，这种场景下 SDK 定义了两种用户角色：观众（默认）和主播。主播能够发送和接收音视频，观众不能发送、只能接收音视频。你可以通过设置 <code>createClient</code> 的 [role](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/clientconfig.html#role) 参数来指定用户角色，也可以调用 [setClientRole](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/iagorartcclient.html#setclientrole) 来动态修改用户角色。</p>
<h3 id="加入频道"><a href="#加入频道" class="headerlink" title="加入频道"></a>加入频道</h3><p>创建 <code>AgoraRTCClient</code> 对象后，就可以调用 [AgoraRTCClient.join](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/iagorartcclient.html#join) 加入频道。</p>
<p>该方法为异步方法，使用时需要配合 <code>Promise</code> 或 <code>async/await</code>。</p>
<p>注意 <code>join</code> 方法的第四个参数 <code>uid</code> 的设置。不传入任何值时，Agora 会为这个加入的本地用户自动分配一个 Number 型的用户 ID 作为其唯一的身份标识。你也可以通过该参数自行指定一个 Number 型的用户 ID。</p>
<p>请确保频道内用户 ID 的唯一性。Agora 建议你在业务层面避免用户使用相同的 ID 加入一个频道。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 自动分配数字 UID</span></span><br><span class="line"><span class="keyword">const</span> uid = <span class="keyword">await</span> client.join(<span class="string">&quot;APPID&quot;</span>, <span class="string">&quot;CHANNEL&quot;</span>, <span class="string">&quot;TOKEN&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 指定数字 UID</span></span><br><span class="line"><span class="keyword">await</span> client.join(<span class="string">&quot;APPID&quot;</span>, <span class="string">&quot;CHANNEL&quot;</span>, <span class="string">&quot;TOKEN&quot;</span>, <span class="number">393939</span>);</span><br></pre></td></tr></table></figure>

<h3 id="离开频道"><a href="#离开频道" class="headerlink" title="离开频道"></a>离开频道</h3><p>调用 [AgoraRTCClient.leave](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/iagorartcclient.html#leave) 可以离开当前频道。该方法可以在任何时候调用，包括正在加入频道时或者正在重连时。</p>
<p>该方法为异步方法，使用时需要配合 <code>Promise</code> 或 <code>async/await</code>。</p>
<p>调用 <code>leave</code> 后，SDK 会立刻销毁与当前频道相关的对象，包括订阅的远端用户对象、远端轨道对象、记录连接状态的对象等。如果需要再次加入频道，在调用 <code>leave</code> 后再调用 <code>join</code> 即可。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> client.leave();</span><br></pre></td></tr></table></figure>

<h3 id="频道内的连接状态"><a href="#频道内的连接状态" class="headerlink" title="频道内的连接状态"></a>频道内的连接状态</h3><p>详见[频道连接状态管理](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/channel_connection_web_ng?platform=Web)。</p>
<h3 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h3><p>在加入频道的过程中，因为 SDK 使用不当或者网络异常等原因，可能会抛出以下错误：</p>
<ul>
<li><code>INVALID_PARAMS</code>: 提供的参数错误，比如提供了格式非法的 Token。</li>
<li><code>INVALID_OPERATION</code>: 非法操作。该错误通常是重复加入频道引起的，请确保重复加入时先调用 <code>leave</code>。</li>
<li><code>OPERATION_ABORTED</code>: 加入被中止，表示在 <code>join</code> 方法成功之前就调用了 <code>leave</code> 方法。</li>
<li><code>UNEXPECTED_RESPONSE</code>: Agora 服务器返回了非预期的响应，通常是因为 App ID 或 Token 鉴权失败，例如开启了 App 证书却未传入 Token。</li>
<li><code>UID_CONFLICT</code>: 创建了多个 <code>AgoraRTCClient</code> 对象，且重复使用了同一个用户 ID。</li>
</ul>
<h2 id="创建本地轨道对象"><a href="#创建本地轨道对象" class="headerlink" title="创建本地轨道对象"></a>创建本地轨道对象</h2><p>本文仅适用于 Agora Web SDK 4.x 版本。</p>
<p>本文详细介绍如何使用 Agora Web SDK 创建本地的音视频轨道对象。</p>
<p>在介绍具体的 API 之前，你需要了解本地轨道对象的一些设计细节。Agora Web SDK 使用了面向对象的设计模式，使用 [LocalTrack](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/ilocaltrack.html) 这一个基础的抽象类来描述所有的本地轨道对象，它定义了本地轨道对象的公共方法和行为，所有的本地轨道对象都继承于 <code>LocalTrack</code>。</p>
<p><code>publish</code> 方法只要求发布的对象是 <code>LocalTrack</code> ，所以无论通过什么方式创建的本地轨道对象，都满足 <code>publish</code> 方法的参数要求。</p>
<p>基于 <code>LocalTrack</code>，SDK 定义了 [LocalAudioTrack](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/ilocalaudiotrack.html) 和 [LocalVideoTrack](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/ilocalvideotrack.html)，分别代表本地音频轨道对象和本地视频轨道对象。这两个类分别针对音视频不同的特性增加了不同的方法，比如 <code>LocalAudioTrack</code> 增加了获取和控制音量的方法、<code>LocalVideoTrack</code> 增加了设置美颜功能的方法。</p>
<p>最后，根据不同的应用场景和创建方式， SDK 基于 <code>LocalAudioTrack</code> 和 <code>LocalVideoTrack</code> 提供了更上层的本地轨道类。比如继承自 <code>LocalVideoTrack</code> 的 <code>CameraVideoTrack</code>，这个类表明这个本地视频轨道是来自于摄像头采集的视频，所以这个类增加了控制摄像头、调整分辨率等方法。</p>
<p>下图展示了这几个类之间的关系：</p>
<p><img src="https://raw.githubusercontent.com/andylinwenqin/Picgo/main/img/20210809235859.png"></p>
<h3 id="创建轨道"><a href="#创建轨道" class="headerlink" title="创建轨道"></a>创建轨道</h3><p>SDK 支持通过以下方式创建本地轨道对象。</p>
<h3 id="使用麦克风和摄像头"><a href="#使用麦克风和摄像头" class="headerlink" title="使用麦克风和摄像头"></a>使用麦克风和摄像头</h3><p>最常用的方法是直接通过麦克风或者摄像头采集的音视频来创建本地轨道对象，SDK 提供了三种方法：</p>
<ul>
<li>[createCameraVideoTrack](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/iagorartc.html#createcameravideotrack)：使用摄像头采集的视频来创建本地视频轨道，返回一个 [CameraVideoTrack](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/icameravideotrack.html) 对象。</li>
<li>[createMicrophoneAudioTrack](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/iagorartc.html#createmicrophoneaudiotrack)：使用麦克风采集的音频来创建本地音频轨道，返回一个 [MicrophoneAudioTrack](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/imicrophoneaudiotrack.html) 对象。</li>
<li>[createMicrophoneAndCameraTracks](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/iagorartc.html#createmicrophoneandcameratracks)：同时使用麦克风和摄像头采集的音视频创建本地轨道，返回一个包含 [CameraVideoTrack](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/icameravideotrack.html) 和 [MicrophoneAudioTrack](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/imicrophoneaudiotrack.html) 的列表。</li>
</ul>
<p>如果使用 <code>createMicrophoneAndCameraTracks</code> 创建本地轨道，因为音频和视频采集是一次完成的，所以只要摄像头和麦克风其中一个无法完成采集就会导致整个采集的失败，SDK 会抛出错误，详见[错误处理](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/create_local_track_web_ng?platform=Web#error)。如果分别调用 <code>createCameraVideoTrack</code> 和 <code>createMicrophoneAudioTrack</code> ，其中一个采集失败不会影响另外一个。请根据你的实际需求选用合适的方法。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 采集摄像头</span></span><br><span class="line"><span class="keyword">const</span> cameraTrack = <span class="keyword">await</span> AgoraRTC.createCameraVideoTrack();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 采集麦克风</span></span><br><span class="line"><span class="keyword">const</span> microphoneTrack = <span class="keyword">await</span> AgoraRTC.createMicrophoneAudioTrack();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 同时采集摄像头和麦克风</span></span><br><span class="line"><span class="keyword">const</span> [microphoneTrack, cameraTrack] = <span class="keyword">await</span> AgoraRTC.createMicrophoneAndCameraTracks();</span><br></pre></td></tr></table></figure>

<p>调用以上方法时你可以传入一个配置参数来控制采集的行为，详细的参数定义可以参考 [CameraVideoTrackInitConfig](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/cameravideotrackinitconfig.html) 或者 [MicrophoneAudioTrackInitConfig](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/microphoneaudiotrackinitconfig.html)。</p>
<p>以上方法均为异步方法，使用时需要配合 <code>Promise</code> 或 <code>async/await</code>。</p>
<h3 id="使用屏幕画面"><a href="#使用屏幕画面" class="headerlink" title="使用屏幕画面"></a>使用屏幕画面</h3><p>SDK 提供 [createScreenVideoTrack](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/iagorartc.html#createscreenvideotrack) 方法来创建屏幕共享轨道，这个方法会返回 <code>LocalVideoTrack</code> 对象。由于 <code>LocalVideoTrack</code> 只实现了视频轨道对象的基础方法，因此通过屏幕创建的轨道无法像摄像头轨道那样控制分辨率或切换设备。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> screenTrack = <span class="keyword">await</span> AgoraRTC.createScreenVideoTrack();</span><br></pre></td></tr></table></figure>

<p>该方法为异步方法，使用时需要配合 <code>Promise</code> 或 <code>async/await</code>。</p>
<p>如果你需要在 Electron 或较老版本的 Chrome 上使用屏幕共享，或者希望在共享屏幕的同时分享音频，可以参考[屏幕共享](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/screensharing_web_ng)。</p>
<h3 id="使用本地或在线的音频文件"><a href="#使用本地或在线的音频文件" class="headerlink" title="使用本地或在线的音频文件"></a>使用本地或在线的音频文件</h3><p>SDK 提供 [createBufferSourceAudioTrack](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/iagorartc.html#createbuffersourceaudiotrack) 方法来通过本地或者在线的音频文件创建本地音频轨道对象。通过该方法创建的对象类型为 <code>BufferSourceAudioTrack</code>，该对象继承自 <code>LocalAudioTrack</code>，在其基础上增加了控制音频文件播放行为的方法，比如暂停播放、跳转播放、循环播放等。</p>
<p>你可以使用这个方法实现混音或者播放音效的功能，详见[播放音效/混音](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/audio_effect_mixing_web_ng)。</p>
<p>该方法为异步方法，使用时需要配合 <code>Promise</code> 或 <code>async/await</code>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> audioFileTrack = <span class="keyword">await</span> AgoraRTC.createBufferSourceAudioTrack(&#123;</span><br><span class="line">  <span class="attr">source</span>: <span class="string">&quot;https://web-demos-static.agora.io/agora/smlt.flac&quot;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在播放之前先调用该方法读取音频文件</span></span><br><span class="line">audioFileTrack.startProcessAudioBuffer();</span><br><span class="line"></span><br><span class="line">audioFileTrack.play();</span><br></pre></td></tr></table></figure>

<h3 id="使用自定义方式"><a href="#使用自定义方式" class="headerlink" title="使用自定义方式"></a>使用自定义方式</h3><p>如果你熟悉 WebRTC 或者 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/API/MediaStreamTrack">MediaStreamTrack</a> 相关的 API，你可以通过自己实现采集来完成 <code>MediaStreamTrack</code> 的创建，然后通过 [createCustomAudioTrack](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/iagorartc.html#createcustomaudiotrack) 或者 [createCustomVideoTrack](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/iagorartc.html#createcustomvideotrack) 方法将 <code>MediaStreamTrack</code> 对象转换成 SDK 内部的 <code>LocalAudioTrack</code> 或者 <code>LocalVideoTrack</code> 对象。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 通过自己实现采集获取 `MediaStreamTrack` 对象</span></span><br><span class="line"><span class="keyword">const</span> customMediaStreamTrack = getMediaStreamTrackFromXXX(<span class="comment">/* .. */</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建自定义的视频轨道</span></span><br><span class="line"><span class="keyword">const</span> customTrack = AgoraRTC.createCustomVideoTrack(&#123;</span><br><span class="line">  <span class="attr">mediaStreamTrack</span>: customMediaStreamTrack,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="启用和禁用本地轨道"><a href="#启用和禁用本地轨道" class="headerlink" title="启用和禁用本地轨道"></a>启用和禁用本地轨道</h3><p>创建好本地的轨道对象后，如果想要暂时关闭麦克风或摄像头，你可以禁用该轨道。SDK 提供 [LocalTrack.setEnabled](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/ilocaltrack.html#setenabled) 方法来启用或者禁用本地轨道对象。</p>
<p>该方法为异步方法，使用时需要配合 <code>Promise</code> 或 <code>async/await</code>。</p>
<p>调用 <code>setEnabled(true)</code> 禁用本地轨道后，该轨道会停止本地播放。如果该轨道已经发布，发布也会停止，此时远端会收到 <code>user-unpublished</code> 回调；调用 <code>setEnabled(true)</code> 后，SDK 会自动重新发布轨道。</p>
<p>根据本地轨道类型的不同，调用 <code>setEnabled</code> 后会有一些不同的行为：</p>
<ul>
<li>通过设备采集创建的本地轨道（<code>CameraVideoTrack</code>/<code>MicrophoneAudioTrack</code>）：当调用 <code>setEnabled(false)</code> 后，会停止采集并释放其占用的设备。如果摄像头或麦克风有指示灯，此时指示灯会熄灭。当调用 <code>setEnabled(true)</code> 后，会自动恢复采集。</li>
<li>通过其他方式创建的本地轨道：当调用 <code>setEnabled(false)</code> 后，会默认编码黑屏帧（视频轨道）或者静音包（音频轨道）。当调用 <code>setEnabled(true)</code> 后，会自动恢复正常编码。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> videoTrack = <span class="keyword">await</span> AgoraRTC.createCameraVideoTrack();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 暂时关闭摄像头采集</span></span><br><span class="line"><span class="keyword">await</span> videoTrack.setEnabled(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 恢复摄像头采集</span></span><br><span class="line"><span class="keyword">await</span> videoTrack.setEnabled(<span class="literal">true</span>);</span><br></pre></td></tr></table></figure>

<h3 id="错误处理-1"><a href="#错误处理-1" class="headerlink" title="错误处理"></a>错误处理</h3><p>在创建本地音视频对象的过程中，由于不同设备和浏览器之间的差异，SDK 可能在调用上述方法时抛出异常。以下是调用创建轨道的方法时可能会遇到的错误：</p>
<ul>
<li><code>NOT_SUPPORTED</code>: 使用的功能在当前浏览器上不支持。</li>
<li><code>MEDIA_OPTION_INVALID</code>: 指定的采集参数无法被满足，一般是因为设备不支持指定的分辨率或帧率。</li>
<li><code>DEVICE_NOT_FOUND</code>: 找不到指定的采集设备。</li>
<li><code>PERMISSION_DENIED</code>: 用户拒绝授予访问摄像头/麦克风的权限，或者屏幕共享选择共享源时，用户没有选择共享源，并关闭了选择窗口。</li>
<li><code>CONSTRAINT_NOT_SATISFIED</code>: 浏览器不支持指定的采集选项。</li>
<li><code>SHARE_AUDIO_NOT_ALLOWED</code>: 屏幕共享分享音频时用户没有勾选<strong>分享音频</strong>。</li>
</ul>
<h2 id="发布和订阅"><a href="#发布和订阅" class="headerlink" title="发布和订阅"></a>发布和订阅</h2><p>本文仅适用于 Agora Web SDK 4.x 版本。</p>
<p>本文详细介绍如何使用 Agora Web SDK 发布和取消发布本地音视频，以及订阅和取消订阅远端音视频。</p>
<h3 id="发布音视频"><a href="#发布音视频" class="headerlink" title="发布音视频"></a>发布音视频</h3><p>完成本地轨道的创建并且成功加入频道后，就可以调用 [AgoraRTCClient.publish](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/iagorartcclient.html#publish) 将本地的音视频数据发布到当前频道，以供频道中的其他用户订阅。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> localAudioTrack = ...;</span><br><span class="line"><span class="keyword">const</span> localVideoTrack = ...;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 你可以多次调用 publish 发布多个轨道</span></span><br><span class="line"><span class="keyword">await</span> client.publish(localAudioTrack);</span><br><span class="line"><span class="keyword">await</span> client.publish(localVideoTrack);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 也可以一次性将需要发布的轨道一起发布</span></span><br><span class="line"><span class="keyword">await</span> client.publish([localAudioTrack, localVideoTrack]);</span><br></pre></td></tr></table></figure>

<p>关于发布，注意事项如下：</p>
<ul>
<li><p>同一时间只能发布一个视频轨道。</p>
</li>
<li><p>可以同时发布多个音频轨道，SDK 会自动混音。</p>
<blockquote>
<p>Safari 12 之前的版本不支持混音，无法使用此特性。</p>
</blockquote>
</li>
<li><p>可以多次调用该方法来发布不同的轨道，但是不能重复发布同一个轨道对象。</p>
</li>
<li><p>该方法为异步方法，使用时需要配合 <code>Promise</code> 或 <code>async/await</code>。</p>
</li>
</ul>
<h3 id="错误处理-2"><a href="#错误处理-2" class="headerlink" title="错误处理"></a>错误处理</h3><p>在发布过程中，可能因为网络环境或者 SDK 使用不当抛出以下错误：</p>
<ul>
<li><code>INVALID_OPERATION</code>: 非法操作，说明在加入频道成功之前就调用了 <code>publish</code> 方法。</li>
<li><code>OPERATION_ABORTED</code>: 发布被中止，可能是因为在发布成功之前就主动调用 <code>leave</code> 离开了频道。</li>
<li><code>INVALID_LOCAL_TRACK</code>: 参数错误，传入了非法的 <code>LocalTrack</code> 对象。</li>
<li><code>CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS</code>: 不允许同时发布多个视频轨道。</li>
<li><code>NOT_SUPPORTED</code>: 发布了多个音频轨道，但是浏览器不支持混音。</li>
<li><code>UNEXPECTED_RESPONSE</code>: 收到了 Agora 服务器异常的返回，发布轨道失败。建议保留日志，联系 Agora <a target="_blank" rel="noopener" href="https://agora-ticket.agora.io/">技术支持</a>。</li>
<li><code>NO_ICE_CANDIDATE</code>: 找不到本地网络出口，可能是网络防火墙或者启用了禁止 WebRTC 的浏览器插件。详见 <a target="_blank" rel="noopener" href="https://docs.agora.io/cn/faq/console_error_web#none-ice-candidate-not-alloweda-namecandidatea">FAQ</a>。</li>
</ul>
<h3 id="取消发布音视频"><a href="#取消发布音视频" class="headerlink" title="取消发布音视频"></a>取消发布音视频</h3><p>成功发布本地轨道后，如果想取消发布，可以调用 [AgoraRTCClient.unpublish](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/iagorartcclient.html#unpublish)。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 发布音视频</span></span><br><span class="line"><span class="keyword">await</span> client.publish([localAudioTrack, localVideoTrack]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 取消发布视频，此时音频还在正常发布</span></span><br><span class="line"><span class="keyword">await</span> client.unpublish(localVideoTrack);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 也可以一次将所有正在发布的轨道全部取消发布</span></span><br><span class="line"><span class="keyword">await</span> client.unpublish();</span><br><span class="line"><span class="comment">// 或者批量取消发布</span></span><br><span class="line"><span class="keyword">await</span> client.unpublish([localAudioTrack, localVideoTrack]);</span><br></pre></td></tr></table></figure>

<p>关于取消发布，注意事项如下：</p>
<ul>
<li>该方法可以多次调用。你可以使用 <code>publish</code> 和 <code>unpublish</code> 实现发布和取消发布某个本地轨道。</li>
<li>该方法为异步方法，使用时需要配合 <code>Promise</code> 或 <code>async/await</code>。</li>
</ul>
<h3 id="订阅音视频"><a href="#订阅音视频" class="headerlink" title="订阅音视频"></a>订阅音视频</h3><p>当远端用户成功发布音视频轨道之后，SDK 会触发 [user-published](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/iagorartcclient.html#event_user_published) 事件。这个事件携带两个参数：远端用户对象（<code>user</code>）和远端发布的媒体类型（<code>mediaType</code>）。此时，你可以调用 [AgoraRTCClient.subscribe](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/iagorartcclient.html#subscribe) 发起订阅。</p>
<blockquote>
<p>该方法为异步方法，使用时需要配合 <code>Promise</code> 或者 <code>async/await</code>。</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">client.on(<span class="string">&quot;user-published&quot;</span>, <span class="keyword">async</span> (user, mediaType) =&gt; &#123;</span><br><span class="line">  <span class="comment">// 发起订阅</span></span><br><span class="line">  <span class="keyword">await</span> client.subscribe(user, mediaType);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 如果订阅的是音频轨道</span></span><br><span class="line">  <span class="keyword">if</span> (mediaType === <span class="string">&quot;audio&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> audioTrack = user.audioTrack;</span><br><span class="line">    <span class="comment">// 自动播放音频</span></span><br><span class="line">    audioTrack.play();</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> videoTrack = user.videoTrack;</span><br><span class="line">    <span class="comment">// 自动播放视频</span></span><br><span class="line">    videoTrack.play(DOM_ELEMENT);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>当订阅方法调用完成之后，你可以通过 <code>user.audioTrack</code> 和 <code>user.videoTrack</code> 获取相应的 [RemoteAudioTrack](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/iremoteaudiotrack.html) 和 [RemoteVideoTrack](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/iremotevideotrack.html) 对象。</p>
<p>订阅和发布不同，每次订阅只能订阅一个音频或视频轨道。即使发布端同时发布了音频轨道和视频轨道，SDK 也会触发两次 <code>user-published</code> 事件：一次 <code>user-published(audio)</code>，一次 <code>user-published(video)</code>。按照上面的代码逻辑，会完成两次订阅。</p>
<h3 id="处理-Autoplay-问题"><a href="#处理-Autoplay-问题" class="headerlink" title="处理 Autoplay 问题"></a>处理 Autoplay 问题</h3><p>详见[处理浏览器的自动播放策略](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/autoplay_policy_web_ng)。</p>
<h3 id="错误处理-3"><a href="#错误处理-3" class="headerlink" title="错误处理"></a>错误处理</h3><p>在订阅过程中，因为网络环境等因素 SDK 可能抛出如下错误：</p>
<ul>
<li><code>INVALID_OPERATION</code>: 非法操作，可能在加入频道成功之前就调用了 <code>subscribe</code>。</li>
<li><code>INVALID_REMOTE_USER</code>: 传入了非法的远端用户对象，例如该用户不在频道内。</li>
<li><code>REMOTE_USER_IS_NOT_PUBLISHED</code>：传入的远端用户没有发布 <code>subscribe</code> 方法中传入的媒体类型。</li>
<li><code>UNEXPECTED_RESPONSE</code>: 收到了 Agora 服务器异常的返回，订阅失败。建议保留日志，联系 Agora <a target="_blank" rel="noopener" href="https://agora-ticket.agora.io/">技术支持</a>。</li>
<li><code>OPERATION_ABORTED</code>: 操作中止，可能在订阅成功之前就调用 <code>leave</code> 离开了频道。</li>
<li><code>NO_ICE_CANDIDATE</code>: 找不到本地网络出口，可能是网络防火墙或者启用了禁止 WebRTC 的浏览器插件。详见 <a target="_blank" rel="noopener" href="https://docs.agora.io/cn/faq/console_error_web#none-ice-candidate-not-alloweda-namecandidatea">FAQ</a>。</li>
</ul>
<h3 id="取消订阅音视频"><a href="#取消订阅音视频" class="headerlink" title="取消订阅音视频"></a>取消订阅音视频</h3><p>你可以通过 [AgoraRTCClient.unsubscribe](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/iagorartcclient.html#unsubscribe) 取消订阅远端的音视频。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 订阅目标用户的音视频</span></span><br><span class="line"><span class="keyword">await</span> client.subscribe(user, <span class="string">&quot;audio&quot;</span>);</span><br><span class="line"><span class="keyword">await</span> client.subscribe(user, <span class="string">&quot;video&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 取消订阅视频</span></span><br><span class="line"><span class="keyword">await</span> client.unsubscribe(user, <span class="string">&quot;video&quot;</span>);</span><br><span class="line"><span class="comment">// 也可以取消订阅当前用户的所有媒体类型</span></span><br><span class="line"><span class="keyword">await</span> client.unsubscribe(user);</span><br></pre></td></tr></table></figure>

<p>关于取消订阅，注意事项如下：</p>
<ul>
<li>取消订阅成功后，SDK 会释放相应的 <code>RemoteTrack</code> 对象。一旦远端轨道对象被释放，SDK 会自动移除视频的播放元素，音频播放也会停止。</li>
<li>如果远端用户主动取消发布，本地会收到 <code>user-unpublished</code> 回调，收到该回调时 SDK 会自动释放相应的 <code>RemoteTrack</code> 对象，你无需再调用 <code>unsubscribe</code>。</li>
<li>该方法为异步方法，使用时需要配合 <code>Promise</code> 或 <code>async/await</code>。</li>
</ul>
<h2 id="api文档参考"><a href="#api文档参考" class="headerlink" title="api文档参考"></a>api文档参考</h2><p>Agora Web SDK 是通过 HTML 网页加载的 JavaScript 和 Typescript 库。你可以使用 Agora Web SDK 在网页浏览器中调用 API 建立连接，控制音视频通话和直播服务。</p>
<blockquote>
<p>请务必使用 HTTPS 协议或者 localhost，否则 SDK 无法正常工作。</p>
</blockquote>
<p>[全局模块](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/index.html#全局模块)</p>
<p>[AgoraRTC](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/iagorartc.html) 是 Agora Web SDK 中所有可调用方法的入口，主要包含以下方法。</p>
<p>[核心方法](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/index.html#核心方法)</p>
<table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">[createClient](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/iagorartc.html#createclient)</td>
<td align="left">创建本地客户端</td>
</tr>
</tbody></table>
<p>[本地音视频采集](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/index.html#本地音视频采集)</p>
<table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">[createMicrophoneAudioTrack](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/iagorartc.html#createmicrophoneaudiotrack)</td>
<td align="left">通过麦克风创建一个音频轨道对象</td>
</tr>
<tr>
<td align="left">[createCameraVideoTrack](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/iagorartc.html#createcameravideotrack)</td>
<td align="left">通过摄像头创建一个视频轨道对象</td>
</tr>
<tr>
<td align="left">[createMicrophoneAndCameraTracks](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/iagorartc.html#createmicrophoneandcameratracks)</td>
<td align="left">同时创建麦克风音频轨道和摄像头视频轨道</td>
</tr>
<tr>
<td align="left">[createScreenVideoTrack](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/iagorartc.html#createscreenvideotrack)</td>
<td align="left">通过屏幕共享创建一个视频轨道对象</td>
</tr>
<tr>
<td align="left">[createBufferSourceAudioTrack](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/iagorartc.html#createbuffersourceaudiotrack)</td>
<td align="left">通过音频文件创建一个音频轨道对象</td>
</tr>
<tr>
<td align="left">[createCustomAudioTrack](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/iagorartc.html#createcustomaudiotrack)</td>
<td align="left">创建一个自定义的音频轨道对象</td>
</tr>
<tr>
<td align="left">[createCustomVideoTrack](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/iagorartc.html#createcustomvideotrack)</td>
<td align="left">创建一个自定义的视频轨道对象</td>
</tr>
</tbody></table>
<p>[媒体设备查询](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/index.html#媒体设备查询)</p>
<table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">[getDevices](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/iagorartc.html#getdevices)</td>
<td align="left">获取媒体设备列表</td>
</tr>
<tr>
<td align="left">[getCameras](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/iagorartc.html#getcameras)</td>
<td align="left">获取摄像头列表</td>
</tr>
<tr>
<td align="left">[getMicrophones](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/iagorartc.html#getmicrophones)</td>
<td align="left">获取麦克风列表</td>
</tr>
<tr>
<td align="left">[getPlaybackDevices](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/iagorartc.html#getplaybackdevices)</td>
<td align="left">获取音频播放设备列表</td>
</tr>
<tr>
<td align="left">[getElectronScreenSources](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/iagorartc.html#getelectronscreensources)</td>
<td align="left">获取 Electron 屏幕共享源列表</td>
</tr>
</tbody></table>
<p>[日志管理](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/index.html#日志管理)</p>
<table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">[enableLogUpload](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/iagorartc.html#enablelogupload)</td>
<td align="left">打开日志上传功能</td>
</tr>
<tr>
<td align="left">[disableLogUpload](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/iagorartc.html#disablelogupload)</td>
<td align="left">关闭日志上传功能</td>
</tr>
<tr>
<td align="left">[setLogLevel](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/iagorartc.html#setloglevel)</td>
<td align="left">设置日志等级</td>
</tr>
</tbody></table>
<p>[全局事件回调](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/index.html#全局事件回调)</p>
<table>
<thead>
<tr>
<th align="left">回调</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">[onCameraChanged](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/iagorartc.html#oncamerachanged)</td>
<td align="left">视频采集设备状态变化回调</td>
</tr>
<tr>
<td align="left">[onMicrophoneChanged](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/iagorartc.html#onmicrophonechanged)</td>
<td align="left">音频采集设备状态变化回调</td>
</tr>
<tr>
<td align="left">[onAudioAutoplayFailed](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/iagorartc.html#onaudioautoplayfailed)</td>
<td align="left">音频轨道自动播放失败回调</td>
</tr>
</tbody></table>
<p>[其他](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/index.html#其他)</p>
<table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">[checkSystemRequirements](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/iagorartc.html#checksystemrequirements)</td>
<td align="left">检测浏览器兼容性</td>
</tr>
<tr>
<td align="left">[getSupportedCodec](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/iagorartc.html#getsupportedcodec)</td>
<td align="left">获取支持的编码格式</td>
</tr>
<tr>
<td align="left">[createChannelMediaRelayConfiguration](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/iagorartc.html#createchannelmediarelayconfiguration)</td>
<td align="left">创建跨频道媒体流转发的配置对象</td>
</tr>
</tbody></table>
<h3 id="AgoraRTCClient-类"><a href="#AgoraRTCClient-类" class="headerlink" title="AgoraRTCClient 类"></a>AgoraRTCClient 类</h3><p>调用 [createClient](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/iagorartc.html#createclient) 创建一个本地客户端对象 [AgoraRTCClient](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/iagorartcclient.html)，代表一个通话中的本地用户。<code>AgoraRTCClient</code> 类提供音视频通话的核心功能，主要包含以下方法。</p>
<table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">[join](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/iagorartcclient.html#join)</td>
<td align="left">加入频道</td>
</tr>
<tr>
<td align="left">[leave](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/iagorartcclient.html#leave)</td>
<td align="left">离开频道</td>
</tr>
<tr>
<td align="left">[publish](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/iagorartcclient.html#publish)</td>
<td align="left">发布本地音视频轨道</td>
</tr>
<tr>
<td align="left">[unpublish](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/iagorartcclient.html#unpublish)</td>
<td align="left">取消发布本地音视频轨道</td>
</tr>
<tr>
<td align="left">[subscribe](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/iagorartcclient.html#subscribe)</td>
<td align="left">订阅远端用户的音视频轨道</td>
</tr>
<tr>
<td align="left">[unsubscribe](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/iagorartcclient.html#unsubscribe)</td>
<td align="left">取消订阅远端用户的音视频轨道</td>
</tr>
</tbody></table>
<h3 id="LocalTrack-类"><a href="#LocalTrack-类" class="headerlink" title="LocalTrack 类"></a>LocalTrack 类</h3><p><code>LocalTrack</code> 是 Agora Web SDK 中定义本地音视频轨道的抽象类，可用于本地播放和发布。</p>
<p>SDK 通过不同的方式创建不同的 <code>LocalTrack</code>，返回不同的 <code>LocalTrack</code> 派生类对象。以下列举了所有的 <code>LocalTrack</code> 派生类以及所对应的创建方式。</p>
<p>[本地音频轨道](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/index.html#本地音频轨道)</p>
<p>根据创建方式的不同，本地音频轨道可分为以下三种。其中 <code>LocalAudioTrack</code> 派生自 <code>LocalTrack</code>，<code>MicrophoneAudioTrack</code> 和 <code>BufferSourceAudioTrack</code> 派生自 <code>LocalAudioTrack</code>。</p>
<table>
<thead>
<tr>
<th align="left">本地音频轨道</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">[LocalAudioTrack](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/ilocalaudiotrack.html)</td>
<td align="left">最基础的本地音频轨道对象，包含了基础的本地音频控制，如播放、设置音量控制。 通过调用 [AgoraRTC.createCustomAudioTrack](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/iagorartc.html#createcustomaudiotrack) 创建。</td>
</tr>
<tr>
<td align="left">[MicrophoneAudioTrack](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/imicrophoneaudiotrack.html)</td>
<td align="left">本地麦克风音频轨道对象，比 [LocalAudioTrack](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/ilocalaudiotrack.html) 多一些控制麦克风的方法。 通过调用 [AgoraRTC.createMicrophoneAudioTrack](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/iagorartc.html#createmicrophoneaudiotrack) 创建。</td>
</tr>
<tr>
<td align="left">[BufferSourceAudioTrack](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/ibuffersourceaudiotrack.html)</td>
<td align="left">通过读取音频数据源创建的本地音频轨道，比基础的 [LocalAudioTrack](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/ilocalaudiotrack.html) 多一些控制音频数据源的方法。 通过调用 [AgoraRTC.createBufferSourceAudioTrack](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/iagorartc.html#createbuffersourceaudiotrack) 创建。</td>
</tr>
</tbody></table>
<p>[本地视频轨道](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/index.html#本地视频轨道)</p>
<p>根据创建方式的不同，本地视频可分为以下两种。其中 <code>LocalVideoTrack</code> 派生自 <code>LocalTrack</code>，<code>CameraVideoTrack</code> 派生自 <code>LocalVideoTrack</code>。</p>
<table>
<thead>
<tr>
<th align="left">本地视频轨道</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">[LocalVideoTrack](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/ilocalvideotrack.html)</td>
<td align="left">最基础的本地视频轨道对象，包含了基础的本地视频控制，如播放、美颜。 通过调用 [AgoraRTC.createCustomVideoTrack](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/iagorartc.html#createcustomvideotrack) 或 [AgoraRTC.createScreenVideoTrack](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/iagorartc.html#createscreenvideotrack) 创建。</td>
</tr>
<tr>
<td align="left">[CameraVideoTrack](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/icameravideotrack.html)</td>
<td align="left">本地摄像头视频轨道对象，比 [LocalVideoTrack](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/ilocalvideotrack.html) 多一些控制摄像头和编码参数的方法。 通过调用 [AgoraRTC.createCameraVideoTrack](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/iagorartc.html#createcameravideotrack) 创建。</td>
</tr>
</tbody></table>
<h3 id="RemoteTrack-类"><a href="#RemoteTrack-类" class="headerlink" title="RemoteTrack 类"></a>RemoteTrack 类</h3><p><code>RemoteTrack</code> 是 Agora Web SDK 中用于定义远端音视频轨道的抽象类。</p>
<p>在实际操作中，你需要先调用 [AgoraRTCClient.subscribe](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/iagorartcclient.html#subscribe) 订阅远端用户，然后从远端用户对象 [AgoraRTCRemoteUser](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/iagorartcremoteuser.html) 中获取派生自 <code>RemoteTrack</code> 的 [RemoteAudioTrack](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/iremoteaudiotrack.html) 对象和 [RemoteVideoTrack](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/iremotevideotrack.html) 对象。</p>
<p>[引入方式](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/index.html#引入方式)</p>
<p>如果你通过 <code>&lt;script&gt;</code> 的方式引入 Agora Web SDK，可以通过访问 [AgoraRTC.createClient](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/iagorartc.html#createclient) 来获取导出的模块。</p>
<p>如果你通过 <code>npm</code> 或者模块化的方式引入 Agora Web SDK，可以通过以下方式访问 <code>AgoraRTC</code>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> AgoraRTC <span class="keyword">from</span> <span class="string">&quot;agora-rtc-sdk-ng&quot;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(AgoraRTC.createClient);</span><br></pre></td></tr></table></figure>

<p>[类型模块（适用于 Typescript）](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/index.html#类型模块（适用于-typescript）)</p>
<p>对于 Typescript 开发者，我们提供了 <code>.d.ts</code> 文件导出详细的类型定义。你可以查看 API 文档的 [Global](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/globals.html) 页面，该页面列出了所有 SDK 导出的模块和类型。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> AgoraRTC, &#123; IAgoraRTCClient &#125; <span class="keyword">from</span> <span class="string">&quot;agora-rtc-sdk-ng&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> client: IAgoraRTCClient = AgoraRTC.createClient();</span><br></pre></td></tr></table></figure>



<h3 id="错误码"><a href="#错误码" class="headerlink" title="错误码"></a>错误码</h3><p>SDK 可能以下列方式抛出错误码：</p>
<ul>
<li>对于异步方法，SDK 返回 Promise 来通知异步操作的结果，Promise 被 reject 时 SDK 会抛出相应的错误码。</li>
<li>同步方法调用失败时，SDK 直接抛出错误码。</li>
<li>SDK 内部运行过程中，也可能抛出一些网络相关的错误码。</li>
</ul>
<p>你可参考本文了解这些错误码的详细含义及处理方法。</p>
<p>[通用错误码](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/index.html#通用错误码)</p>
<table>
<thead>
<tr>
<th align="left">错误码</th>
<th align="left">描述</th>
<th align="left">处理方法</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>UNEXPECTED_ERROR</code></td>
<td align="left">无法处理的、非预期的错误，通常这个错误会有具体的错误提示。</td>
<td align="left">无</td>
</tr>
<tr>
<td align="left"><code>UNEXPECTED_RESPONSE</code></td>
<td align="left">服务端返回了非预期的响应。</td>
<td align="left">无</td>
</tr>
<tr>
<td align="left"><code>INVALID_PARAMS</code></td>
<td align="left">非法参数。</td>
<td align="left">根据具体提示确认操作，并根据文档传入正确的参数。</td>
</tr>
<tr>
<td align="left"><code>NOT_SUPPORTED</code></td>
<td align="left">浏览器不支持。</td>
<td align="left">参考<a target="_blank" rel="noopener" href="https://agoraio-community.github.io/AgoraWebSDK-NG/docs/zh-CN/overview">浏览器支持情况</a>。</td>
</tr>
<tr>
<td align="left"><code>INVALID_OPERATION</code></td>
<td align="left">非法操作，通常是因为在当前状态不能进行该操作。</td>
<td align="left">确认操作的先后顺序，比如发布前请确认已经加入频道。</td>
</tr>
<tr>
<td align="left"><code>OPERATION_ABORTED</code></td>
<td align="left">操作中止，通常是因为网络质量差或连接断开导致与 Agora 服务器通信失败。</td>
<td align="left">通过 [AgoraRTCClient.on(“user-joined”)](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/iagorartcclient.html#event_user_joined) 回调确认本地网络状况，并重试该操作。</td>
</tr>
<tr>
<td align="left"><code>WEB_SECURITY_RESTRICT</code></td>
<td align="left">浏览器安全策略限制。</td>
<td align="left">请确保 Web 页面运行在<a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts">安全环境</a>中。</td>
</tr>
<tr>
<td align="left"><code>NO_ACTIVE_STATUS</code></td>
<td align="left">Agora 项目未激活或被禁用。</td>
<td align="left">请前往 Agora 控制台确认项目状态是否为启用。</td>
</tr>
</tbody></table>
<p>[请求相关错误码](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/index.html#请求相关错误码)</p>
<p><strong>网络连接</strong></p>
<table>
<thead>
<tr>
<th align="left">错误码</th>
<th align="left">描述</th>
<th align="left">处理方法</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>NETWORK_TIMEOUT</code></td>
<td align="left">请求超时，通常是因为网络质量差或连接断开导致与 Agora 服务器通信失败。</td>
<td align="left">通过 [AgoraRTCClient.on(“user-joined”)](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/iagorartcclient.html#event_user_joined) 回调确认本地网络状况，并重试该操作。</td>
</tr>
<tr>
<td align="left"><code>NETWORK_RESPONSE_ERROR</code></td>
<td align="left">响应错误，一般是状态码非法。</td>
<td align="left">确认操作的参数是否正确，并根据文档传入正确的参数。</td>
</tr>
<tr>
<td align="left"><code>NETWORK_ERROR</code></td>
<td align="left">无法定位的网络错误。</td>
<td align="left">无</td>
</tr>
</tbody></table>
<p><strong>SDK 内部请求</strong></p>
<table>
<thead>
<tr>
<th align="left">错误码</th>
<th align="left">描述</th>
<th align="left">处理方法</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>WS_ABORT</code></td>
<td align="left">请求 Agora 服务器过程中 WebSocket 断开。</td>
<td align="left">监听 [AgoraRTCClient.on(“connection-state-change”)](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/iagorartcclient.html#event_connection_state_change) 事件，待连接状态变为 <strong>CONNECTED</strong> 后重试。</td>
</tr>
<tr>
<td align="left"><code>WS_DISCONNECT</code></td>
<td align="left">请求 Agora 服务器前，WebSocket 就已经断开。</td>
<td align="left">监听 [AgoraRTCClient.on(“connection-state-change”)](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/iagorartcclient.html#event_connection_state_change) 事件，待连接状态变为 <strong>CONNECTED</strong> 后重试。</td>
</tr>
<tr>
<td align="left"><code>WS_ERR</code></td>
<td align="left">WebSocket 连接发生错误。</td>
<td align="left">检查当前浏览器对 WebSocket 的支持情况。</td>
</tr>
</tbody></table>
<p>[设备管理相关错误码](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/index.html#设备管理相关错误码)</p>
<table>
<thead>
<tr>
<th align="left">错误码</th>
<th align="left">描述</th>
<th align="left">处理方法</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>ENUMERATE_DEVICES_FAILED</code></td>
<td align="left">枚举本地设备失败，一般是由于浏览器限制。</td>
<td align="left">无</td>
</tr>
<tr>
<td align="left"><code>DEVICE_NOT_FOUND</code></td>
<td align="left">无法找到指定设备。</td>
<td align="left">传入正确的设备 ID。</td>
</tr>
</tbody></table>
<p>[Track 相关错误码](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/index.html#track-相关错误码)</p>
<table>
<thead>
<tr>
<th align="left">错误码</th>
<th align="left">描述</th>
<th align="left">处理方法</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>TRACK_IS_DISABLED</code></td>
<td align="left">轨道被禁用，通常因为轨道设置了 [Track.setEnabled(false)](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/ilocaltrack.html#setenabled)。</td>
<td align="left">对该轨道调用 [Track.setEnabled(true)](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/ilocaltrack.html#setenabled) 后再进行操作。</td>
</tr>
<tr>
<td align="left"><code>SHARE_AUDIO_NOT_ALLOWED</code></td>
<td align="left">屏幕共享音频时终端用户没有点击<strong>分享音频</strong>。</td>
<td align="left">要求终端用户在弹出的屏幕共享窗口中勾选<strong>分享音频</strong>。</td>
</tr>
<tr>
<td align="left"><code>CHROME_PLUGIN_NO_RESPONSE</code></td>
<td align="left">Chrome 屏幕共享插件无响应。</td>
<td align="left">确认 [Chrome 屏幕共享插件](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/chrome_screensharing_plugin)的状态或重新安装屏幕共享插件。</td>
</tr>
<tr>
<td align="left"><code>CHROME_PLUGIN_NOT_INSTALL</code></td>
<td align="left">Chrome 屏幕共享插件没有安装。</td>
<td align="left">安装 [Chrome 屏幕共享插件](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/chrome_screensharing_plugin)。</td>
</tr>
<tr>
<td align="left"><code>MEDIA_OPTION_INVALID</code></td>
<td align="left">不支持的媒体采集的参数。</td>
<td align="left">修改媒体采集参数或使用 SDK 预设的配置。</td>
</tr>
<tr>
<td align="left"><code>CONSTRAINT_NOT_SATISFIED</code></td>
<td align="left">不支持的媒体采集的参数。</td>
<td align="left">修改媒体采集参数或使用 SDK 预设的配置。</td>
</tr>
<tr>
<td align="left"><code>PERMISSION_DENIED</code></td>
<td align="left">获取媒体设备权限被拒绝。</td>
<td align="left">在弹出的获取设备权限窗口中选择<strong>允许</strong>。</td>
</tr>
<tr>
<td align="left"><code>FETCH_AUDIO_FILE_FAILED</code></td>
<td align="left">下载在线音频文件失败。</td>
<td align="left">填入正确的在线音频地址，并确保可以正常访问。</td>
</tr>
<tr>
<td align="left"><code>READ_LOCAL_AUDIO_FILE_ERROR</code></td>
<td align="left">读取本地音频文件失败。</td>
<td align="left">填入正确的本地音频文件路径。</td>
</tr>
<tr>
<td align="left"><code>DECODE_AUDIO_FILE_FAILED</code></td>
<td align="left">音频文件解码失败，可能是因为音频文件的编码格式是浏览器 WebAudio 不支持的编码格式。</td>
<td align="left">检查浏览器 WebAudio 是否支持音频文件的编码格式。</td>
</tr>
</tbody></table>
<p>[Client 相关错误码](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/index.html#client-相关错误码)</p>
<p><strong>加入频道</strong></p>
<table>
<thead>
<tr>
<th align="left">错误码</th>
<th align="left">描述</th>
<th align="left">处理方法</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>UID_CONFLICT</code></td>
<td align="left">同一个频道内 UID 重复。</td>
<td align="left">使用不同的 UID 进入频道。</td>
</tr>
<tr>
<td align="left"><code>INVALID_UINT_UID_FROM_STRING_UID</code></td>
<td align="left">String UID 分配服务返回了非法的 int UID。</td>
<td align="left">使用不同的 UID 进入频道。</td>
</tr>
<tr>
<td align="left"><code>CAN_NOT_GET_PROXY_SERVER</code></td>
<td align="left">无法获取云代理服务地址。</td>
<td align="left">无</td>
</tr>
<tr>
<td align="left"><code>CAN_NOT_GET_GATEWAY_SERVER</code></td>
<td align="left">无法获取 Agora 服务器地址。</td>
<td align="left">无</td>
</tr>
</tbody></table>
<p><strong>发布/取消发布</strong></p>
<table>
<thead>
<tr>
<th align="left">错误码</th>
<th align="left">描述</th>
<th align="left">处理方法</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>INVALID_LOCAL_TRACK</code></td>
<td align="left">传入了非法的 LocalTrack。</td>
<td align="left">检查传入的 Track，并传入正确的 LocalTrack。</td>
</tr>
<tr>
<td align="left"><code>CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS</code></td>
<td align="left">一个 Client 发布多个视频轨道。</td>
<td align="left">一个 Client 同一时间只能发布一个视频轨道，如果想发布多个视频轨道请创建多个 Client。</td>
</tr>
</tbody></table>
<p><strong>订阅/取消订阅</strong></p>
<table>
<thead>
<tr>
<th align="left">错误码</th>
<th align="left">描述</th>
<th align="left">处理方法</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>INVALID_REMOTE_USER</code></td>
<td align="left">非法的远端用户，可能是远端用户不在频道内或还未发布任何媒体轨道。</td>
<td align="left">收到 [AgoraRTCClient.on(“user-published”)](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/iagorartcclient.html#event_user_published) 事件后再进行订阅操作。</td>
</tr>
<tr>
<td align="left"><code>REMOTE_USER_IS_NOT_PUBLISHED</code></td>
<td align="left">远端用户已发布了音频或视频轨道，但不是与你的订阅操作所指定的类型不符。</td>
<td align="left">请确保订阅操作传入的轨道类型需要与 [AgoraRTCClient.on(“user-published”)](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/iagorartcclient.html#event_user_published)) 事件给出的类型一致，或者在订阅前通过 [AgoraRTCRemoteUser.hasVideo]{@link AgoraRTCRemoteUser.hasVideo} 和 [AgoraRTCRemoteUser.hasAudio]{@link AgoraRTCRemoteUser.hasAudio} 确认远端用户是否发布了该类型的轨道。</td>
</tr>
</tbody></table>
<p>[推流到 CDN](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/index.html#推流到-cdn)</p>
<table>
<thead>
<tr>
<th align="left">错误码</th>
<th align="left">描述</th>
<th align="left">处理方法</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>LIVE_STREAMING_TASK_CONFLICT</code></td>
<td align="left">推流任务已经存在。</td>
<td align="left">先调用 [Client.stopLiveStreaming](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/iagorartcclient.html#stoplivestreaming) 停止该推流任务再重新进行推流操作。</td>
</tr>
<tr>
<td align="left"><code>LIVE_STREAMING_INVALID_ARGUMENT</code></td>
<td align="left">推流参数错误。</td>
<td align="left">参考 [Client.startLiveStreaming](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/iagorartcclient.html#startlivestreaming) 的 API 文档检查推流操作的参数。</td>
</tr>
<tr>
<td align="left"><code>LIVE_STREAMING_INTERNAL_SERVER_ERROR</code></td>
<td align="left">推流服务器内部错误。</td>
<td align="left">重新进行推流操作，如果仍然失败，刷新页面重试。</td>
</tr>
<tr>
<td align="left"><code>LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED</code></td>
<td align="left">推流 URL 被占用。</td>
<td align="left">检查填入的 URL 是否被占用。</td>
</tr>
<tr>
<td align="left"><code>LIVE_STREAMING_CDN_ERROR</code></td>
<td align="left">推流的目标 CDN 出现错误导致推流失败。</td>
<td align="left">确认目标 CDN 的健康状况。</td>
</tr>
<tr>
<td align="left"><code>LIVE_STREAMING_INVALID_RAW_STREAM</code></td>
<td align="left">推流超时。</td>
<td align="left">确认目标流是否存在。</td>
</tr>
</tbody></table>
<p>[跨频道连麦](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/index.html#跨频道连麦)</p>
<table>
<thead>
<tr>
<th align="left">错误码</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>CROSS_CHANNEL_WAIT_STATUS_ERROR</code></td>
<td align="left">等待 [AgoraRTCClient.on(“channel-media-relay-state”)](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/iagorartcclient.html#event_channel_media_relay_state) 回调出错。</td>
</tr>
<tr>
<td align="left"><code>CROSS_CHANNEL_FAILED_JOIN_SRC</code></td>
<td align="left">发起跨频道转发媒体流请求失败。</td>
</tr>
<tr>
<td align="left"><code>CROSS_CHANNEL_FAILED_JOIN_DEST</code></td>
<td align="left">接受跨频道转发媒体流请求失败。</td>
</tr>
<tr>
<td align="left"><code>CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST</code></td>
<td align="left">服务器接收跨频道转发媒体流失败。</td>
</tr>
<tr>
<td align="left"><code>CROSS_CHANNEL_SERVER_ERROR_RESPONSE</code></td>
<td align="left">服务器响应出错。</td>
</tr>
</tbody></table>
<h2 id="官方实例"><a href="#官方实例" class="headerlink" title="官方实例"></a>官方实例</h2><p>本文仅适用于 Agora Web SDK 4.x 版本。如果你使用的是 3.x 或之前版本，请查看以下文档：</p>
<p>[跑通视频直播示例项目](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/run_demo_live_web?platform=Web)</p>
<p>[实现音频直播](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/start_live_audio_web?platform=Web)</p>
<p>[实现视频直播](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/start_live_web?platform=Web)</p>
<p>根据本文指导快速集成 Agora Web SDK 并在你自己的 app 里实现实时音视频直播。</p>
<blockquote>
<p>由于浏览器的安全策略对除 127.0.0.1 以外的 HTTP 地址作了限制，Agora Web SDK 仅支持 HTTPS 协议或者 <code>http://localhost</code>（<code>http://127.0.0.1</code>）。请勿使用 HTTP 协议在 <code>http://localhost</code>（<code>http://127.0.0.1</code>） 之外访问你的项目。</p>
</blockquote>
<h3 id="开源示例项目"><a href="#开源示例项目" class="headerlink" title="开源示例项目"></a>开源示例项目</h3><p>我们在 GitHub 上提供一个开源的<a target="_blank" rel="noopener" href="https://github.com/AgoraIO/API-Examples-Web">示例项目</a>供你参考。</p>
<p>同时，你可以通过我们的<a target="_blank" rel="noopener" href="https://webdemo.agora.io/agora-websdk-api-example-4.x/">在线 Web 应用</a>快速体验 Agora 实现的音视频相关功能。</p>
<h3 id="前提条件"><a href="#前提条件" class="headerlink" title="前提条件"></a>前提条件</h3><ul>
<li>可以连接到互联网的 Windows 或 macOS 计算机。如果你的网络环境部署了防火墙，请参考[应用企业防火墙限制](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Agora">https://docs.agora.io/cn/Agora</a> Platform/firewall?platform=Web)以正常使用 Agora 服务。</li>
<li>计算机搭载 2.2 GHz Intel 第二代 i3/i5/i7 处理器或同等性能的其他处理器。</li>
<li>物理音视频采集设备，如内置摄像头和麦克风。</li>
<li>安装最新稳定版 <a target="_blank" rel="noopener" href="https://www.google.cn/chrome/">Chrome 浏览器</a>。</li>
<li>有效的 Agora [开发者账号](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Agora">https://docs.agora.io/cn/Agora</a> Platform/sign_in_and_sign_up?platform=Web)。</li>
</ul>
<h3 id="获取-SDK"><a href="#获取-SDK" class="headerlink" title="获取 SDK"></a>获取 SDK</h3><p>选择如下任意一种方法获取 Agora Web SDK：</p>
<h4 id="方法-1-使用-npm-获取-SDK"><a href="#方法-1-使用-npm-获取-SDK" class="headerlink" title="方法 1. 使用 npm 获取 SDK"></a>方法 1. 使用 npm 获取 SDK</h4><p>使用该方法需要先安装 npm，详见 <a target="_blank" rel="noopener" href="https://www.npmjs.com.cn/getting-started/installing-node/">npm 快速入门</a>。</p>
<ol>
<li><p>运行安装命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install agora-rtc-sdk-ng --save</span><br></pre></td></tr></table></figure></li>
<li><p>在你的项目的 JavaScript 代码中加入以下代码，引入这个模块：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> AgoraRTC <span class="keyword">from</span> <span class="string">&quot;agora-rtc-sdk-ng&quot;</span></span><br><span class="line"><span class="keyword">const</span> client = AgoraRTC.createClient(&#123; <span class="attr">mode</span>: <span class="string">&quot;rtc&quot;</span>, <span class="attr">codec</span>: <span class="string">&quot;vp8&quot;</span> &#125;);</span><br></pre></td></tr></table></figure>

<p>如果你使用 TypeScript, 还可以引入 SDK 中的类型对象：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> AgoraRTC, &#123; IAgoraRTCClient &#125; <span class="keyword">from</span> <span class="string">&quot;agora-rtc-sdk-ng&quot;</span></span><br><span class="line"><span class="keyword">const</span> client: IAgoraRTCClient = AgoraRTC.createClient(&#123; <span class="attr">mode</span>: <span class="string">&quot;rtc&quot;</span>, <span class="attr">codec</span>: <span class="string">&quot;vp8&quot;</span> &#125;);</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="方法-2-使用-CDN-方法获取-SDK"><a href="#方法-2-使用-CDN-方法获取-SDK" class="headerlink" title="方法 2. 使用 CDN 方法获取 SDK"></a>方法 2. 使用 CDN 方法获取 SDK</h4><p>该方法无需下载安装包。在项目 HTML 文件中，添加如下代码：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://download.agora.io/sdk/release/AgoraRTC_N-4.6.2.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="方法-3-手动下载-SDK"><a href="#方法-3-手动下载-SDK" class="headerlink" title="方法 3. 手动下载 SDK"></a>方法 3. 手动下载 SDK</h4><ol>
<li><p>[下载](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/downloads?platform=Web) Agora Web SDK 4.x 版本 SDK 包。</p>
</li>
<li><p>将下载下来的 <code>.js</code> 文件保存到项目文件所在的目录下。</p>
</li>
<li><p>在项目文件中，将如下代码添加到 HTML 中：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./AgoraRTC_N-4.6.2.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ol>
<blockquote>
<ul>
<li>在方法 2 和方法 3 中，SDK 都会在全局导出一个 <code>AgoraRTC</code> 对象，直接访问这个对象即可操作 SDK。</li>
<li>在我们的示例项目中，为方便起见，我们选择第二种方法，直接使用 CDN 链接。</li>
</ul>
</blockquote>
<p>现在，我们已经将 Agora Web SDK 集成到项目中了。下一步我们要调用 Agora Web SDK 提供的核心 API。</p>
<h3 id="常用对象"><a href="#常用对象" class="headerlink" title="常用对象"></a>常用对象</h3><p>在使用 Agora Web SDK 时，你会经常用到以下三种对象：</p>
<ul>
<li>[AgoraRTCClient](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/iagorartcclient.html) 对象，代表一个本地客户端。<code>AgoraRTCClient</code> 类的方法提供了音视频通话的主要功能，例如加入频道、发布音视频轨道等。</li>
<li>[LocalTrack](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/ilocalaudiotrack.html) 对象和 [RemoteTrack](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/iremotetrack.html) 对象，代表本地和远端的音视频轨道对象，用于播放等音视频相关的控制。</li>
</ul>
<blockquote>
<p>音视频流由音视频轨道构成。在 Agora Web SDK 中，我们通过操作音视频轨道对象来控制音视频流的行为。</p>
</blockquote>
<h3 id="基本流程"><a href="#基本流程" class="headerlink" title="基本流程"></a>基本流程</h3><p>一次简单的音视频直播的步骤一般如下：</p>
<ol>
<li>根据项目的 App ID 创建一个本地客户端 <code>AgoraRTCClient</code> 对象，</li>
<li>调用 <code>AgoraRTCClient.setClientRole</code> 设置用户角色。</li>
<li>通过 <code>AgoraRTCClient.join</code> 加入到一个指定的频道中。</li>
<li>通过麦克风采集的音频创建一个 <code>MicrophoneAudioTrack</code> 对象（本地音频轨道对象）；通过摄像头采集的视频创建一个 <code>CameraVideoTrack</code> 对象（本地视频轨道对象）。</li>
<li>通过 <code>AgoraRTCClient.publish</code> 将创建的本地音视频轨道对象发布到频道中。</li>
</ol>
<p>当有其他用户加入频道并且也发布音视频轨道时：</p>
<ol>
<li>SDK 会触发 <code>client.on(&quot;user-published&quot;)</code> 事件，在这个事件回调函数的参数中你可以拿到远端用户对象 <code>AgoraRTCRemoteUser</code>，表示这个用户刚刚发布了音视频轨道。</li>
<li>通过 <code>AgoraRTCClient.subscribe</code> 订阅获取到的 <code>AgoraRTCRemoteUser</code>。</li>
<li>订阅完成后，访问 <code>AgoraRTCRemoteUser.audioTrack</code> 和 <code>AgoraRTCRemoteUser.videoTrack</code> 即可获取到 <code>RemoteAudioTrack</code>（远端音频轨道对象）和 <code>RemoteVideoTrack</code>（远端视频轨道对象）。</li>
</ol>
<p>下图展示了基础的音视频直播的 API 调用。注意图中的方法是对不同的对象调用的。</p>
<p><img src="https://raw.githubusercontent.com/andylinwenqin/Picgo/main/img/20210810000548.png"></p>
<p>为方便起见，我们预定义了两个变量和一个函数，下面的所有示例代码都包裹在这个函数中。此步骤不是必须的，你可以根据你的项目有其他的实现。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> rtc = &#123;</span><br><span class="line">  <span class="comment">// 用来放置本地客户端。</span></span><br><span class="line">  <span class="attr">client</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="comment">// 用来放置本地音视频频轨道对象。</span></span><br><span class="line">  <span class="attr">localAudioTrack</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">localVideoTrack</span>: <span class="literal">null</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> options = &#123;</span><br><span class="line">  <span class="comment">// 替换成你自己项目的 App ID。</span></span><br><span class="line">  <span class="attr">appId</span>: <span class="string">&quot;&lt;YOUR APP ID&gt;&quot;</span>,</span><br><span class="line">  <span class="comment">// 传入目标频道名。</span></span><br><span class="line">  <span class="attr">channel</span>: <span class="string">&quot;demo_channel_name&quot;</span>,</span><br><span class="line">  <span class="comment">// 如果你的项目开启了 App 证书进行 Token 鉴权，这里填写生成的 Token 值。</span></span><br><span class="line">  <span class="attr">token</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="comment">// 设置频道内的用户角色，可设为 &quot;audience&quot; 或 &quot;host&quot;</span></span><br><span class="line">  <span class="attr">role</span>: <span class="string">&quot;audience&quot;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">startBasicLive</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 接下来的代码写在这里。</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">startBasicLive();</span><br></pre></td></tr></table></figure>

<h4 id="1-创建本地客户端"><a href="#1-创建本地客户端" class="headerlink" title="1. 创建本地客户端"></a>1. 创建本地客户端</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rtc.client = AgoraRTC.createClient(&#123; <span class="attr">mode</span>: <span class="string">&quot;live&quot;</span>, <span class="attr">codec</span>: <span class="string">&quot;vp8&quot;</span> &#125;);</span><br></pre></td></tr></table></figure>

<p>调用 <code>createClient</code> 方法创建本地客户端对象。需注意 <code>mode</code> 和 <code>codec</code> 这两个参数的设置：</p>
<ul>
<li><p><code>mode</code> 用于设置[频道场景](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Agora">https://docs.agora.io/cn/Agora</a> Platform/terms?platform=All Platforms#channel-profile)。Agora Web SDK 会根据使用场景的不同实行不同的优化策略。</p>
<ul>
<li>一对一或多人通话中，建议设为 <code>&quot;rtc&quot;</code>，使用通信场景。</li>
<li>互动直播中，建议设为 <code>&quot;live&quot;</code>，使用直播场景。</li>
</ul>
</li>
<li><p><code>codec</code> 用于设置浏览器使用的编解码格式。如果你需要使用 Safari 12.1 及之前版本，将该参数设为 <code>&quot;h264&quot;</code>；其他情况我们推荐使用 <code>&quot;vp8&quot;</code>。</p>
</li>
</ul>
<h4 id="2-设置用户角色"><a href="#2-设置用户角色" class="headerlink" title="2. 设置用户角色"></a>2. 设置用户角色</h4><p>直播频道有两种用户角色：主播和观众，默认的角色为观众。直播频道内的用户，只能看到主播的画面、听到主播的声音。</p>
<p>设置频道场景为直播后，你可以调用 <code>setClientRole</code> 方法设置用户角色。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Role 的值可以是 &quot;host&quot; 或者 &quot;audience&quot;。</span></span><br><span class="line">client.setClientRole(options.role);</span><br></pre></td></tr></table></figure>

<p>加入频道后，如果你想切换用户角色，也可以调用 <code>setClientRole</code> 方法。</p>
<h4 id="3-加入目标频道"><a href="#3-加入目标频道" class="headerlink" title="3. 加入目标频道"></a>3. 加入目标频道</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> uid = <span class="keyword">await</span> rtc.client.join(options.appId, options.channel, options.token, <span class="literal">null</span>);</span><br></pre></td></tr></table></figure>

<p>调用 <code>join</code> 加入目标频道。该方法返回一个 <code>Promise</code>，当返回 <code>resolve</code> 时表示加入频道成功，返回 <code>reject</code> 时表示加入频道出现错误。我们可以利用 <code>async/await</code> 极大地简化我们的代码。</p>
<p>调用 <code>join</code> 方法时你需要注意以下参数：</p>
<ul>
<li><p><code>appid</code>: 你的 App ID。详见[创建 Agora 项目](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/run_demo_video_call_web?platform=Web##1-创建-agora-项目)和[获取 App ID](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/run_demo_video_call_web?platform=Web#appid)。</p>
</li>
<li><p><code>channel</code>: 频道名，长度在 64 字节以内的字符串。在我们的示例项目中，<code>channel</code> 的值设为 <code>demo_channel_name</code>。</p>
</li>
<li><p><code>token</code>: （可选）如果你的 Agora 项目开启了 App 证书，你需要在该参数中传入一个 Token，详见[使用 Token](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Agora">https://docs.agora.io/cn/Agora</a> Platform/token?platform=All Platforms#使用-token)。</p>
<ul>
<li><p>在测试环境，我们推荐使用控制台生成临时 Token，详见[获取临时 Token](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Agora">https://docs.agora.io/cn/Agora</a> Platform/token?platform=All Platforms%23get-a-temporary-token#获取临时-token)。</p>
</li>
<li><p>在生产环境，我们推荐你在自己的服务端生成 Token，详见</p>
<p>生成 Token</p>
<blockquote>
<p>在我们的示例项目中，为了叙述方便，没有开启 App 证书，所以不需要校验 Token，<code>token</code> 的值为 <code>null</code>。如果你启用了 App 证书，请确保上面传入的 <code>channel</code> 值和生成 Token 时传入的 <code>channel</code> 值保持一致。</p>
</blockquote>
</li>
</ul>
</li>
<li><p><code>uid</code>：用户 ID，频道内每个用户的 UID 必须是唯一的。你可以填 <code>null</code>，Agora 会自动分配一个 UID 并在 <code>join</code> 的结果中返回。</p>
</li>
</ul>
<p>更多的 API 介绍和注意事项请参考 [AgoraRTCClient.join](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/iagorartcclient.html#join) 接口中的参数描述。</p>
<h4 id="4-创建并发布本地音视频轨道"><a href="#4-创建并发布本地音视频轨道" class="headerlink" title="4. 创建并发布本地音视频轨道"></a>4. 创建并发布本地音视频轨道</h4><p>当用户角色设为主播时，成功加入频道后，就可以创建并发布本地音视频轨道了。</p>
<p>如果用户角色设为观众，跳过该步骤。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 通过麦克风采集的音频创建本地音频轨道对象。</span></span><br><span class="line">rtc.localAudioTrack = <span class="keyword">await</span> AgoraRTC.createMicrophoneAudioTrack();</span><br><span class="line"><span class="comment">// 通过摄像头采集的视频创建本地视频轨道对象。</span></span><br><span class="line">rtc.localVideoTrack = <span class="keyword">await</span> AgoraRTC.createCameraVideoTrack();</span><br><span class="line"><span class="comment">// 将这些音视频轨道对象发布到频道中。</span></span><br><span class="line"><span class="keyword">await</span> rtc.client.publish([rtc.localAudioTrack, rtc.localVideoTrack]);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;publish success!&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>我们先调用 <code>createMicrophoneAudioTrack</code> 通过麦克风采集的音频创建本地音频轨道对象，调用 <code>createCameraVideoTrack</code> 通过摄像头采集的视频创建本地视频轨道对象；然后调用 <code>publish</code> 方法，将这些本地音视频轨道对象当作参数即可将音视频发布到频道中。</p>
<blockquote>
<ul>
<li>以上方法都会返回 <code>Promise</code>，<code>resolve</code> 时代表成功，<code>reject</code> 时代表失败。我们使用 <code>async/await</code> 来让代码逻辑更清晰。</li>
<li>由于加入频道和创建本地音视频轨道没有依赖关系，你可以利用 <code>Promise.all</code> 同时执行这些异步操作。</li>
</ul>
</blockquote>
<p>详细的参数设置（如采集设备和编码参数）请参考相关 API 文档：</p>
<ul>
<li>[createMicrophoneAudioTrack](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/iagorartc.html#createmicrophoneaudiotrack)</li>
<li>[createCameraVideoTrack](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/iagorartc.html#createcameravideotrack)</li>
<li>[publish](<a target="_blank" rel="noopener" href="https://docs.agora.io/cn/Interactive">https://docs.agora.io/cn/Interactive</a> Broadcast/API Reference/web_ng/interfaces/iagorartcclient.html#publish)</li>
</ul>
<h4 id="5-订阅远端用户"><a href="#5-订阅远端用户" class="headerlink" title="5. 订阅远端用户"></a>5. 订阅远端用户</h4><p>当远端用户发布音视频轨道时，SDK 会触发 <code>client.on(&quot;user-published&quot;)</code> 事件。我们需要通过 <code>client.on</code> 监听该事件并在回调中订阅新加入的远端用户。</p>
<blockquote>
<p>我们建议<strong>在创建客户端对象之后立即监听事件</strong>，以避免错过任何事件。放在这里介绍是因为叙述顺序。</p>
</blockquote>
<p>在 <code>createClient</code> 后下一行插入以下代码，监听 <code>client.on(&quot;user-published&quot;)</code> 事件，当有远端用户发布时开始订阅，并在订阅后自动播放远端音视频轨道对象。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">rtc.client.on(<span class="string">&quot;user-published&quot;</span>, <span class="keyword">async</span> (user, mediaType) =&gt; &#123;</span><br><span class="line">  <span class="comment">// 开始订阅远端用户。</span></span><br><span class="line">  <span class="keyword">await</span> rtc.client.subscribe(user, mediaType);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;subscribe success&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 表示本次订阅的是视频。</span></span><br><span class="line">  <span class="keyword">if</span> (mediaType === <span class="string">&quot;video&quot;</span>) &#123;</span><br><span class="line">    <span class="comment">// 订阅完成后，从 `user` 中获取远端视频轨道对象。</span></span><br><span class="line">    <span class="keyword">const</span> remoteVideoTrack = user.videoTrack;</span><br><span class="line">    <span class="comment">// 动态插入一个 DIV 节点作为播放远端视频轨道的容器。</span></span><br><span class="line">    <span class="keyword">const</span> playerContainer = <span class="built_in">document</span>.createElement(<span class="string">&quot;div&quot;</span>);</span><br><span class="line">    <span class="comment">// 给这个 DIV 节点指定一个 ID，这里指定的是远端用户的 UID。</span></span><br><span class="line">    playerContainer.id = user.uid.toString();</span><br><span class="line">    playerContainer.style.width = <span class="string">&quot;640px&quot;</span>;</span><br><span class="line">    playerContainer.style.height = <span class="string">&quot;480px&quot;</span>;</span><br><span class="line">    <span class="built_in">document</span>.body.append(playerContainer);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 订阅完成，播放远端音视频。</span></span><br><span class="line">    <span class="comment">// 传入 DIV 节点，让 SDK 在这个节点下创建相应的播放器播放远端视频。</span></span><br><span class="line">    remoteVideoTrack.play(playerContainer);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 也可以只传入该 DIV 节点的 ID。</span></span><br><span class="line">    <span class="comment">// remoteVideoTrack.play(playerContainer.id);</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 表示本次订阅的是音频。</span></span><br><span class="line">  <span class="keyword">if</span> (mediaType === <span class="string">&quot;audio&quot;</span>) &#123;</span><br><span class="line">    <span class="comment">// 订阅完成后，从 `user` 中获取远端音频轨道对象。</span></span><br><span class="line">    <span class="keyword">const</span> remoteAudioTrack = user.audioTrack;</span><br><span class="line">    <span class="comment">// 播放音频因为不会有画面，不需要提供 DOM 元素的信息。</span></span><br><span class="line">    remoteAudioTrack.play();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>你需要注意 <code>user-published</code> 事件的第二个参数 <code>mediaType</code>, 代表远端用户当前发布的媒体类型：</p>
<ul>
<li><code>audio</code>: 远端用户发布了音频轨道。</li>
<li><code>video</code>: 远端用户发布了视频轨道。</li>
</ul>
<p>当远端用户取消发布或离开频道时，SDK 会触发 <code>client.on(&quot;user-unpublished&quot;)</code> 事件。此时我们需要销毁刚刚动态创建的 DIV 节点。</p>
<p>在刚刚监听 <code>client.on(&quot;user-published&quot;)</code> 事件的代码下一行插入以下代码，监听 <code>client.on(&quot;user-unpublished&quot;)</code> 事件。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">rtc.client.on(<span class="string">&quot;user-unpublished&quot;</span>, <span class="function">(<span class="params">user, mediaType</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (mediaType === <span class="string">&quot;video&quot;</span>) &#123;</span><br><span class="line">    <span class="comment">// 获取刚刚动态创建的 DIV 节点。</span></span><br><span class="line">    <span class="keyword">const</span> playerContainer = <span class="built_in">document</span>.getElementById(user.uid.toString());</span><br><span class="line">    <span class="comment">// 销毁这个节点。</span></span><br><span class="line">    playerContainer.remove();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="6-离开频道"><a href="#6-离开频道" class="headerlink" title="6. 离开频道"></a>6. 离开频道</h4><p>通过以下步骤离开频道：</p>
<ol>
<li>销毁创建的本地音视频轨道，解除网页对摄像头和麦克风的访问。</li>
<li>手动销毁之前动态创建的 DIV 节点。</li>
<li>调用 <code>leave</code> 离开频道。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">leaveCall</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 销毁本地音视频轨道。</span></span><br><span class="line">  rtc.localAudioTrack.close();</span><br><span class="line">  rtc.localVideoTrack.close();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 遍历远端用户。</span></span><br><span class="line">  rtc.client.remoteUsers.forEach(<span class="function"><span class="params">user</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 销毁动态创建的 DIV 节点。</span></span><br><span class="line">    <span class="keyword">const</span> playerContainer = <span class="built_in">document</span>.getElementById(user.uid);</span><br><span class="line">    playerContainer &amp;&amp; playerContainer.remove();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 离开频道。</span></span><br><span class="line">  <span class="keyword">await</span> rtc.client.leave();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>在不同的产品设计中，离开频道可以既不销毁本地流，也不销毁动态创建的 DIV 节点。这些操作不是必须的，根据您自己的情况调整代码。</p>
</blockquote>
<h2 id="项目代码"><a href="#项目代码" class="headerlink" title="项目代码"></a>项目代码</h2><p>AgoraRTC_Audio.vue       js核心代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="keyword">import</span> AgoraRTC <span class="keyword">from</span> <span class="string">&quot;agora-rtc-sdk-ng&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;AgoraRTC_Audio&#x27;</span>,</span><br><span class="line">        <span class="attr">props</span>: &#123;</span><br><span class="line">            <span class="attr">uid</span>: &#123;</span><br><span class="line">                <span class="attr">default</span>: <span class="literal">null</span>,</span><br><span class="line">                <span class="attr">type</span>: <span class="built_in">Number</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">status</span>: &#123;</span><br><span class="line">                <span class="attr">default</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="attr">type</span>: <span class="built_in">Boolean</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">channel</span>: <span class="built_in">String</span>,</span><br><span class="line">            <span class="attr">token</span>: <span class="built_in">String</span>,</span><br><span class="line">            <span class="attr">appId</span>: &#123;</span><br><span class="line">                <span class="attr">type</span>: <span class="built_in">String</span>,</span><br><span class="line">                <span class="attr">default</span>: <span class="string">&#x27;f4e2f949feaf400583aa1872ffeed2eb&#x27;</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">videoContainerId</span>: <span class="built_in">String</span>,</span><br><span class="line">            <span class="attr">classroomRole</span>: <span class="built_in">Number</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                <span class="attr">loading</span>: <span class="literal">false</span>,</span><br><span class="line">                <span class="attr">client</span>: <span class="literal">null</span>,</span><br><span class="line">                <span class="attr">localAudioTrack</span>: <span class="literal">null</span>,</span><br><span class="line">                <span class="attr">localVideoTrack</span>: <span class="literal">null</span>,</span><br><span class="line">                <span class="attr">remoteUsers</span>: &#123;&#125;,</span><br><span class="line">                <span class="attr">localStream</span>: <span class="literal">null</span>,</span><br><span class="line">                <span class="attr">publishStatus</span>: <span class="literal">false</span>,</span><br><span class="line">                <span class="attr">checkDeviceTime</span>: <span class="number">5</span>,</span><br><span class="line">                <span class="attr">fun</span>: &#123;</span><br><span class="line">                    <span class="string">&#x27;audioinput&#x27;</span>: <span class="literal">true</span>,</span><br><span class="line">                    <span class="string">&#x27;videoinput&#x27;</span>: <span class="literal">true</span>,</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">methods</span>: &#123;</span><br><span class="line">            <span class="keyword">async</span> <span class="function"><span class="title">deviceCheck</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&#x27;deviceCheck&#x27;</span>)</span><br><span class="line">                AgoraRTC.onMicrophoneChanged = <span class="function">(<span class="params">info</span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="built_in">console</span>.log(<span class="string">&quot;microphone changed!&quot;</span>, info.state, info.device);</span><br><span class="line">                &#125;;</span><br><span class="line">                <span class="keyword">let</span> res = &#123;</span><br><span class="line">                    <span class="attr">code</span>: <span class="number">0</span>,</span><br><span class="line">                    <span class="attr">msg</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line">                &#125;</span><br><span class="line">              </span><br><span class="line">                <span class="keyword">let</span> devices = <span class="keyword">await</span> <span class="built_in">this</span>.getDevices()</span><br><span class="line">                <span class="built_in">console</span>.log(devices)</span><br><span class="line">                <span class="keyword">if</span>(!<span class="built_in">Object</span>.keys(devices).length)&#123;</span><br><span class="line">                    res.code = <span class="number">1</span></span><br><span class="line">                    res.msg = <span class="built_in">this</span>.GLOBAL.errorMsg.main[<span class="string">&#x27;mic device is not fount&#x27;</span>]</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="keyword">let</span> &#123;audioinput, videoinput&#125; = devices</span><br><span class="line">                    <span class="keyword">let</span> audioId = audioinput.deviceId;</span><br><span class="line">                    <span class="keyword">let</span> videoId = videoinput.deviceId;</span><br><span class="line">                    <span class="keyword">let</span> audioTrack = <span class="keyword">await</span> AgoraRTC.createMicrophoneAudioTrack(&#123; <span class="attr">microphoneId</span>: audioId &#125;)</span><br><span class="line">                    <span class="keyword">let</span> videoTrack = <span class="keyword">await</span> AgoraRTC.createCameraVideoTrack(&#123;<span class="attr">cameraId</span>: videoId&#125;);</span><br><span class="line">                    <span class="keyword">let</span> status = <span class="keyword">await</span> <span class="built_in">this</span>.deviceCheckAction(audioTrack, videoTrack)</span><br><span class="line">                    <span class="keyword">if</span>(!status)&#123;</span><br><span class="line">                        res.code = <span class="number">0</span></span><br><span class="line">                        res.msg = <span class="built_in">this</span>.GLOBAL.errorMsg.main[<span class="string">&#x27;have mic no volume&#x27;</span>]</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> res</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="keyword">async</span> <span class="function"><span class="title">getDevices</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                <span class="keyword">let</span> devices = <span class="keyword">await</span> AgoraRTC.getDevices()</span><br><span class="line">                <span class="built_in">console</span>.log(devices)</span><br><span class="line">                devices = devices || []</span><br><span class="line">                <span class="keyword">let</span> &#123;fun&#125; = <span class="built_in">this</span></span><br><span class="line">                <span class="keyword">let</span> funDe = &#123;&#125;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">var</span> i <span class="keyword">in</span> devices)&#123;</span><br><span class="line">                    <span class="keyword">let</span> &#123;kind&#125; = devices[i]</span><br><span class="line">                    <span class="keyword">if</span>(!fun[kind] || funDe[kind]) <span class="keyword">continue</span></span><br><span class="line">                    funDe[kind] = devices[i]</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> funDe</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="function"><span class="title">deviceCheckAction</span>(<span class="params">audioTrack</span>)</span>&#123;</span><br><span class="line">                <span class="keyword">let</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">success</span> =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">let</span> t = <span class="built_in">this</span>.checkDeviceTime * <span class="number">1000</span></span><br><span class="line">                    <span class="keyword">let</span> num = t, status = <span class="literal">false</span></span><br><span class="line">                    <span class="keyword">let</span> interval = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                        num = num - <span class="number">1000</span></span><br><span class="line">                        <span class="keyword">const</span> level = audioTrack.getVolumeLevel();</span><br><span class="line">                        <span class="keyword">if</span>(level &gt; <span class="number">0</span>)&#123;</span><br><span class="line">                            status = <span class="literal">true</span></span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="built_in">console</span>.log(<span class="string">&quot;local stream audio level&quot;</span>, level);</span><br><span class="line">                        <span class="keyword">if</span>(t &lt;= <span class="number">0</span> || status)&#123;</span><br><span class="line">                            <span class="built_in">clearInterval</span>(interval)</span><br><span class="line">                            success(<span class="literal">true</span>)</span><br><span class="line">                            <span class="keyword">return</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;, <span class="number">1000</span>);</span><br><span class="line">                    <span class="built_in">this</span>.GLOBAL.timeoutGet(t).then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                        <span class="keyword">if</span>(!status) success(<span class="literal">false</span>)</span><br><span class="line">                    &#125;)</span><br><span class="line">                &#125;)</span><br><span class="line">                <span class="keyword">return</span> promise</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="keyword">async</span> <span class="function"><span class="title">pageInit</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                <span class="built_in">this</span>.localAudioTrack = <span class="keyword">await</span> AgoraRTC.createMicrophoneAudioTrack();</span><br><span class="line">                <span class="built_in">this</span>.localVideoTrack = <span class="keyword">await</span> AgoraRTC.createCameraVideoTrack();</span><br><span class="line">                <span class="built_in">this</span>.client = AgoraRTC.createClient(&#123; <span class="attr">mode</span>: <span class="string">&quot;rtc&quot;</span>, <span class="attr">codec</span>: <span class="string">&quot;vp8&quot;</span> &#125;)</span><br><span class="line">                <span class="built_in">this</span>.eventInit()</span><br><span class="line">                <span class="comment">// 订阅自己的视频</span></span><br><span class="line">                <span class="keyword">if</span>(<span class="built_in">this</span>.localVideoTrack) <span class="built_in">this</span>.localVideoTrack.play(<span class="built_in">this</span>.getVideoContainerId(&#123;<span class="attr">uid</span>: <span class="built_in">this</span>.uid&#125;))</span><br><span class="line">                <span class="keyword">await</span> <span class="built_in">this</span>.join()</span><br><span class="line">                <span class="comment">// 发布</span></span><br><span class="line">                <span class="keyword">await</span> <span class="built_in">this</span>.publishCon();</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="keyword">async</span> <span class="function"><span class="title">pageInitS</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                <span class="built_in">this</span>.client = AgoraRTC.createClient(&#123; <span class="attr">mode</span>: <span class="string">&quot;rtc&quot;</span>, <span class="attr">codec</span>: <span class="string">&quot;vp8&quot;</span> &#125;)</span><br><span class="line">                <span class="built_in">this</span>.eventInit()</span><br><span class="line">                <span class="keyword">await</span> <span class="built_in">this</span>.join()</span><br><span class="line">                <span class="keyword">await</span> <span class="built_in">this</span>.publishCon();</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="keyword">async</span> <span class="function"><span class="title">join</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                <span class="keyword">let</span> res = <span class="keyword">await</span> <span class="built_in">this</span>.client.join(<span class="built_in">this</span>.appId, <span class="built_in">this</span>.channel, <span class="built_in">this</span>.token, <span class="built_in">this</span>.uid);</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&#x27;join status&#x27;</span>)</span><br><span class="line">                <span class="built_in">console</span>.log(res)</span><br><span class="line">                <span class="keyword">return</span> res</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="keyword">async</span> <span class="function"><span class="title">renewToken</span>(<span class="params">token</span>)</span>&#123;</span><br><span class="line">                token = token || <span class="built_in">this</span>.token</span><br><span class="line">                <span class="keyword">let</span> res = <span class="keyword">await</span> <span class="built_in">this</span>.client.renewToken(token)</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="function"><span class="title">getVideoContainerId</span>(<span class="params">user</span>)</span>&#123;</span><br><span class="line">                <span class="comment">// let &#123;videoContainerId&#125; = this</span></span><br><span class="line">                <span class="comment">// if(videoContainerId) return videoContainerId</span></span><br><span class="line">                <span class="comment">// const playerContainer = document.createElement(&quot;div&quot;);</span></span><br><span class="line">                <span class="comment">// // 给这个 DIV 节点指定一个 ID，这里指定的是远端用户的 UID。</span></span><br><span class="line">                <span class="comment">// playerContainer.id = user.uid.toString();</span></span><br><span class="line">                <span class="comment">// playerContainer.style.width = &quot;640px&quot;;</span></span><br><span class="line">                <span class="comment">// playerContainer.style.height = &quot;480px&quot;;</span></span><br><span class="line">                <span class="comment">// document.body.append(playerContainer);</span></span><br><span class="line">                <span class="comment">// return playerContainer.id</span></span><br><span class="line">                <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;user.uid&#125;</span>_user_video`</span></span><br><span class="line"></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="function"><span class="title">eventInit</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                <span class="built_in">this</span>.client.on(<span class="string">&quot;user-published&quot;</span>, <span class="keyword">async</span> (user, mediaType) =&gt; &#123;</span><br><span class="line">                    <span class="built_in">console</span>.log(<span class="string">&#x27;user-published&#x27;</span>)</span><br><span class="line">                    <span class="comment">// 开始订阅远端用户。</span></span><br><span class="line">                    <span class="keyword">await</span> <span class="built_in">this</span>.client.subscribe(user, mediaType);</span><br><span class="line">                    <span class="built_in">console</span>.log(<span class="string">&quot;subscribe success&quot;</span>);</span><br><span class="line">                    <span class="built_in">console</span>.log(mediaType)</span><br><span class="line">                    <span class="comment">// 表示本次订阅的是音频。</span></span><br><span class="line">                    <span class="keyword">if</span> (mediaType === <span class="string">&quot;audio&quot;</span>) &#123;</span><br><span class="line">                        <span class="comment">// 订阅完成后，从 `user` 中获取远端音频轨道对象。</span></span><br><span class="line">                        <span class="keyword">const</span> remoteAudioTrack = user.audioTrack;</span><br><span class="line">                        <span class="comment">// 播放音频因为不会有画面，不需要提供 DOM 元素的信息。</span></span><br><span class="line">                        remoteAudioTrack.play();</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// 表示本次订阅的是视频。</span></span><br><span class="line">                    <span class="keyword">if</span> (mediaType === <span class="string">&quot;video&quot;</span>) &#123;</span><br><span class="line">                        <span class="comment">// 订阅完成后，从 `user` 中获取远端视频轨道对象。</span></span><br><span class="line">                        <span class="keyword">const</span> remoteVideoTrack = user.videoTrack;</span><br><span class="line">                        <span class="comment">// // 动态插入一个 DIV 节点作为播放远端视频轨道的容器。</span></span><br><span class="line">                        <span class="comment">// const playerContainer = document.createElement(&quot;div&quot;);</span></span><br><span class="line">                        <span class="comment">// // 给这个 DIV 节点指定一个 ID，这里指定的是远端用户的 UID。</span></span><br><span class="line">                        <span class="comment">// playerContainer.id = user.uid.toString();</span></span><br><span class="line">                        <span class="comment">// playerContainer.style.width = &quot;640px&quot;;</span></span><br><span class="line">                        <span class="comment">// playerContainer.style.height = &quot;480px&quot;;</span></span><br><span class="line">                        <span class="comment">// document.body.append(playerContainer);</span></span><br><span class="line"></span><br><span class="line">                        <span class="comment">// // 订阅完成，播放远端音视频。</span></span><br><span class="line">                        <span class="comment">// // 传入 DIV 节点，让 SDK 在这个节点下创建相应的播放器播放远端视频。</span></span><br><span class="line">                        <span class="comment">// remoteVideoTrack.play(playerContainer);</span></span><br><span class="line"></span><br><span class="line">                        <span class="comment">// // 也可以只传入该 DIV 节点的 ID。</span></span><br><span class="line">                        <span class="keyword">let</span> id = <span class="built_in">this</span>.getVideoContainerId(user)</span><br><span class="line">                        remoteVideoTrack.play(id);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line"></span><br><span class="line">                <span class="comment">//远端用户或主播加入频道回调</span></span><br><span class="line">                <span class="built_in">this</span>.client.on(<span class="string">&#x27;user-joined&#x27;</span>, <span class="function"><span class="params">user</span> =&gt;</span> &#123;</span><br><span class="line">                    <span class="built_in">console</span>.log(<span class="string">&#x27;用户加入频道&#x27;</span>)</span><br><span class="line">                    <span class="built_in">console</span>.log(user)</span><br><span class="line">                &#125;)</span><br><span class="line"></span><br><span class="line">                <span class="comment">//远端用户离线回调</span></span><br><span class="line">                <span class="built_in">this</span>.client.on(<span class="string">&#x27;user-left&#x27;</span>, <span class="function"><span class="params">user</span> =&gt;</span> &#123;</span><br><span class="line">                    <span class="built_in">console</span>.log(<span class="string">&#x27;用户离开频道&#x27;</span>)</span><br><span class="line">                    <span class="built_in">console</span>.log(user)</span><br><span class="line">                &#125;)</span><br><span class="line"></span><br><span class="line">                <span class="comment">//报告频道内正在说话的远端用户及其音量的回调</span></span><br><span class="line">                <span class="built_in">this</span>.client.on(<span class="string">&#x27;volume-indicator&#x27;</span>, <span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">                    <span class="built_in">console</span>.log(data)</span><br><span class="line">                &#125;)</span><br><span class="line"></span><br><span class="line">                <span class="comment">//token过期回调</span></span><br><span class="line">                <span class="built_in">this</span>.client.on(<span class="string">&#x27;token-privilege-did-expire&#x27;</span>, <span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">                    <span class="built_in">console</span>.log(<span class="string">&#x27;token 失效&#x27;</span>)</span><br><span class="line">                    <span class="built_in">this</span>.$emit(<span class="string">&#x27;tokenInvalid&#x27;</span>)</span><br><span class="line">                &#125;)</span><br><span class="line"></span><br><span class="line">                <span class="comment">//token 即将过期(30s)</span></span><br><span class="line">                <span class="built_in">this</span>.client.on(<span class="string">&quot;token-privilege-will-expire&quot;</span>, <span class="keyword">async</span> () =&gt;&#123;</span><br><span class="line">                    <span class="built_in">console</span>.log(<span class="string">&#x27;token 即将 失效&#x27;</span>)</span><br><span class="line">                    <span class="built_in">this</span>.$emit(<span class="string">&#x27;tokenWillInvalid&#x27;</span>)</span><br><span class="line">                    <span class="comment">// await client.renewToken(token);</span></span><br><span class="line">                &#125;);</span><br><span class="line"></span><br><span class="line">                <span class="comment">//异常回调</span></span><br><span class="line">                <span class="built_in">this</span>.client.on(<span class="string">&#x27;exception&#x27;</span>, <span class="built_in">this</span>.handlError)</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="function"><span class="title">handlError</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&#x27;agroa error&#x27;</span>)</span><br><span class="line">                <span class="built_in">console</span>.log(e)</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="keyword">async</span> <span class="function"><span class="title">publishCon</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="built_in">this</span>.status)</span><br><span class="line">                <span class="keyword">if</span>(!<span class="built_in">this</span>.status) <span class="keyword">return</span></span><br><span class="line">                <span class="built_in">this</span>.publish()</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="keyword">async</span> <span class="function"><span class="title">unpublish</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                <span class="comment">// if(!this.client || !this.publishStatus) return</span></span><br><span class="line">                <span class="keyword">if</span>(!<span class="built_in">this</span>.client) <span class="keyword">return</span></span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&#x27;unpublish&#x27;</span>)</span><br><span class="line">                <span class="keyword">await</span> <span class="built_in">this</span>.client.unpublish(<span class="built_in">this</span>.localAudioTrack);</span><br><span class="line">                <span class="built_in">this</span>.publishStatus = <span class="literal">false</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="keyword">async</span> <span class="function"><span class="title">publish</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                <span class="comment">// if(!this.client || this.publishStatus) return</span></span><br><span class="line">                <span class="keyword">if</span>(!<span class="built_in">this</span>.client) <span class="keyword">return</span></span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&#x27;publish&#x27;</span>)</span><br><span class="line">                <span class="keyword">await</span> <span class="built_in">this</span>.client.publish([<span class="built_in">this</span>.localAudioTrack, <span class="built_in">this</span>.localVideoTrack]);</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&quot;publish success!&quot;</span>);</span><br><span class="line">                <span class="built_in">this</span>.publishStatus = <span class="literal">true</span></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="keyword">async</span> <span class="function"><span class="title">leave</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                <span class="keyword">if</span>(!<span class="built_in">this</span>.client || !<span class="built_in">this</span>.client.leave || !<span class="built_in">this</span>.localAudioTrack || !<span class="built_in">this</span>.localAudioTrack.close) <span class="keyword">return</span></span><br><span class="line">                <span class="comment">// 销毁本地音频轨道。</span></span><br><span class="line">                <span class="built_in">this</span>.localAudioTrack.close();</span><br><span class="line">                <span class="built_in">this</span>.localVideoTrack.close();</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 离开频道。</span></span><br><span class="line">                <span class="keyword">await</span> <span class="built_in">this</span>.client.leave();</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="keyword">async</span> <span class="function"><span class="title">bannedVoiceSet</span>(<span class="params">status</span>)</span>&#123;</span><br><span class="line">                status = status || <span class="built_in">this</span>.status</span><br><span class="line">                status ? <span class="built_in">this</span>.publish() : <span class="built_in">this</span>.unpublish()</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">watch</span>: &#123;</span><br><span class="line">            <span class="attr">status</span>: &#123;</span><br><span class="line">                <span class="function"><span class="title">handler</span>(<span class="params">val</span>)</span>&#123;</span><br><span class="line">                    <span class="built_in">this</span>.bannedVoiceSet(val)</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">deep</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="attr">immediate</span>: <span class="literal">true</span></span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>应用文件代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> AgoraRTCAudioVue <span class="keyword">from</span> <span class="string">&#x27;../../components/AgoraRTC_Audio4.vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="title">agoraInit</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">this</span>.agoraDisabled)&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;不开启语音&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// console.log(&#x27;开启语音&#x27;)</span></span><br><span class="line">    <span class="keyword">let</span> status = <span class="keyword">await</span> <span class="built_in">this</span>.deviceCheckOpen()</span><br><span class="line">    <span class="comment">// this.agoraStatus = status</span></span><br><span class="line">    <span class="comment">// if(!status) return</span></span><br><span class="line">    <span class="keyword">await</span> <span class="built_in">this</span>.agoraToekInit()</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">this</span>.agoraChannelName &amp;&amp; <span class="built_in">this</span>.agoraToken)&#123;</span><br><span class="line">        <span class="comment">// 开启视频</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">this</span>.classroomRole == <span class="number">0</span>)&#123;   </span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;teacher&quot;</span>)</span><br><span class="line">            <span class="keyword">await</span> <span class="built_in">this</span>.$refs[<span class="string">&#x27;AgoraRTCAudioVue&#x27;</span>].pageInit()</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;student&quot;</span>)</span><br><span class="line">            <span class="keyword">await</span> <span class="built_in">this</span>.$refs[<span class="string">&#x27;AgoraRTCAudioVue&#x27;</span>].pageInitS()</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">this</span>.micStatusSet(<span class="literal">true</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>在各个文件中进行带调用完成加入，发布，订阅，销毁等主要功能</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:andylin0119@163.com">林文钦</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://andylinwenqin.github.io/2021/08/09/%E5%A3%B0%E7%BD%91%E8%A7%86%E9%A2%91%E5%92%8C%E9%9F%B3%E9%A2%91%E7%9A%84%E5%AD%A6%E4%B9%A0/">https://andylinwenqin.github.io/2021/08/09/%E5%A3%B0%E7%BD%91%E8%A7%86%E9%A2%91%E5%92%8C%E9%9F%B3%E9%A2%91%E7%9A%84%E5%AD%A6%E4%B9%A0/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://andylinwenqin.github.io" target="_blank">Andylin's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/andylin.github.io/tags/%E5%B7%A5%E4%BD%9C%E7%A7%AF%E7%B4%AF/">工作积累</a></div><div class="post_share"><div class="social-share" data-image="/andylin.github.io/img/2.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/andylin.github.io/2021/08/10/Vue%E4%B8%8B%E6%8B%89%E5%88%B7%E6%96%B0%20%E8%A7%A6%E5%BA%95%E5%88%B7%E6%96%B0/"><img class="prev-cover" src="/andylin.github.io/img/8.jpg" onerror="onerror=null;src='/andylin.github.io/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">下拉刷新 触底刷新</div></div></a></div><div class="next-post pull-right"><a href="/andylin.github.io/2021/07/25/%E5%B0%8F%E7%A8%8B%E5%BA%8F%E9%97%AE%E9%A2%98%E4%B8%8E%E8%A7%A3%E5%86%B3/"><img class="next-cover" src="/andylin.github.io/img/12.jpg" onerror="onerror=null;src='/andylin.github.io/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">小程序问题与解决</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/andylin.github.io/2021/08/10/Vue下拉刷新 触底刷新/" title="下拉刷新 触底刷新"><img class="cover" src="/andylin.github.io/img/8.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-08-10</div><div class="title">下拉刷新 触底刷新</div></div></a></div><div><a href="/andylin.github.io/2021/08/19/Vue组件传值/" title="Vue组件传值"><img class="cover" src="/andylin.github.io/img/8.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-08-19</div><div class="title">Vue组件传值</div></div></a></div><div><a href="/andylin.github.io/2021/08/19/flex布局设置单个元素靠右/" title="flex布局设置单个元素靠右"><img class="cover" src="/andylin.github.io/img/10.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-08-19</div><div class="title">flex布局设置单个元素靠右</div></div></a></div><div><a href="/andylin.github.io/2021/06/26/git工具/" title="git工具"><img class="cover" src="/andylin.github.io/img/2.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-06-26</div><div class="title">git工具</div></div></a></div><div><a href="/andylin.github.io/2021/08/19/文本换行/" title="文本换行省略"><img class="cover" src="/andylin.github.io/img/2.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-08-19</div><div class="title">文本换行省略</div></div></a></div><div><a href="/andylin.github.io/2021/08/23/虚拟机安装linux-centos7系统-及-mysql8（老版本）配置出现的错误/" title="虚拟机安装linux centos7系统 及 mysql8（老版本）配置出现的错误"><img class="cover" src="/andylin.github.io/img/9.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-08-23</div><div class="title">虚拟机安装linux centos7系统 及 mysql8（老版本）配置出现的错误</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" src="/andylin.github.io/img/OIP-C.jpg" onerror="this.onerror=null;this.src='/andylin.github.io/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">林文钦</div><div class="author-info__description">个人知识积累</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/andylin.github.io/archives/"><div class="headline">文章</div><div class="length-num">46</div></a></div><div class="card-info-data-item is-center"><a href="/andylin.github.io/tags/"><div class="headline">标签</div><div class="length-num">15</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/andylinwenqin"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">此博客仅用于个人学习，如有内容需要备注原地址，联系博主</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A3%B0%E7%BD%91"><span class="toc-number">1.</span> <span class="toc-text">声网</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%A7%E5%93%81%E6%A6%82%E8%BF%B0"><span class="toc-number">1.1.</span> <span class="toc-text">产品概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%A0%E5%85%A5%E5%92%8C%E7%A6%BB%E5%BC%80%E9%A2%91%E9%81%93"><span class="toc-number">1.2.</span> <span class="toc-text">加入和离开频道</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA-AgoraRTCClient-%E5%AF%B9%E8%B1%A1"><span class="toc-number">1.2.1.</span> <span class="toc-text">创建 AgoraRTCClient 对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%89%E6%8B%A9%E8%A7%86%E9%A2%91%E7%BC%96%E7%A0%81%E6%A0%BC%E5%BC%8F"><span class="toc-number">1.2.2.</span> <span class="toc-text">选择视频编码格式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%89%E6%8B%A9%E9%A2%91%E9%81%93%E5%9C%BA%E6%99%AF"><span class="toc-number">1.2.3.</span> <span class="toc-text">选择频道场景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A0%E5%85%A5%E9%A2%91%E9%81%93"><span class="toc-number">1.2.4.</span> <span class="toc-text">加入频道</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A6%BB%E5%BC%80%E9%A2%91%E9%81%93"><span class="toc-number">1.2.5.</span> <span class="toc-text">离开频道</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A2%91%E9%81%93%E5%86%85%E7%9A%84%E8%BF%9E%E6%8E%A5%E7%8A%B6%E6%80%81"><span class="toc-number">1.2.6.</span> <span class="toc-text">频道内的连接状态</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86"><span class="toc-number">1.2.7.</span> <span class="toc-text">错误处理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%9C%AC%E5%9C%B0%E8%BD%A8%E9%81%93%E5%AF%B9%E8%B1%A1"><span class="toc-number">1.3.</span> <span class="toc-text">创建本地轨道对象</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%BD%A8%E9%81%93"><span class="toc-number">1.3.1.</span> <span class="toc-text">创建轨道</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E9%BA%A6%E5%85%8B%E9%A3%8E%E5%92%8C%E6%91%84%E5%83%8F%E5%A4%B4"><span class="toc-number">1.3.2.</span> <span class="toc-text">使用麦克风和摄像头</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%B1%8F%E5%B9%95%E7%94%BB%E9%9D%A2"><span class="toc-number">1.3.3.</span> <span class="toc-text">使用屏幕画面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%9C%AC%E5%9C%B0%E6%88%96%E5%9C%A8%E7%BA%BF%E7%9A%84%E9%9F%B3%E9%A2%91%E6%96%87%E4%BB%B6"><span class="toc-number">1.3.4.</span> <span class="toc-text">使用本地或在线的音频文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E8%87%AA%E5%AE%9A%E4%B9%89%E6%96%B9%E5%BC%8F"><span class="toc-number">1.3.5.</span> <span class="toc-text">使用自定义方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%AF%E7%94%A8%E5%92%8C%E7%A6%81%E7%94%A8%E6%9C%AC%E5%9C%B0%E8%BD%A8%E9%81%93"><span class="toc-number">1.3.6.</span> <span class="toc-text">启用和禁用本地轨道</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86-1"><span class="toc-number">1.3.7.</span> <span class="toc-text">错误处理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%91%E5%B8%83%E5%92%8C%E8%AE%A2%E9%98%85"><span class="toc-number">1.4.</span> <span class="toc-text">发布和订阅</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%91%E5%B8%83%E9%9F%B3%E8%A7%86%E9%A2%91"><span class="toc-number">1.4.1.</span> <span class="toc-text">发布音视频</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86-2"><span class="toc-number">1.4.2.</span> <span class="toc-text">错误处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%96%E6%B6%88%E5%8F%91%E5%B8%83%E9%9F%B3%E8%A7%86%E9%A2%91"><span class="toc-number">1.4.3.</span> <span class="toc-text">取消发布音视频</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A2%E9%98%85%E9%9F%B3%E8%A7%86%E9%A2%91"><span class="toc-number">1.4.4.</span> <span class="toc-text">订阅音视频</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%84%E7%90%86-Autoplay-%E9%97%AE%E9%A2%98"><span class="toc-number">1.4.5.</span> <span class="toc-text">处理 Autoplay 问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86-3"><span class="toc-number">1.4.6.</span> <span class="toc-text">错误处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%96%E6%B6%88%E8%AE%A2%E9%98%85%E9%9F%B3%E8%A7%86%E9%A2%91"><span class="toc-number">1.4.7.</span> <span class="toc-text">取消订阅音视频</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#api%E6%96%87%E6%A1%A3%E5%8F%82%E8%80%83"><span class="toc-number">1.5.</span> <span class="toc-text">api文档参考</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#AgoraRTCClient-%E7%B1%BB"><span class="toc-number">1.5.1.</span> <span class="toc-text">AgoraRTCClient 类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LocalTrack-%E7%B1%BB"><span class="toc-number">1.5.2.</span> <span class="toc-text">LocalTrack 类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RemoteTrack-%E7%B1%BB"><span class="toc-number">1.5.3.</span> <span class="toc-text">RemoteTrack 类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%94%99%E8%AF%AF%E7%A0%81"><span class="toc-number">1.5.4.</span> <span class="toc-text">错误码</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%98%E6%96%B9%E5%AE%9E%E4%BE%8B"><span class="toc-number">1.6.</span> <span class="toc-text">官方实例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%80%E6%BA%90%E7%A4%BA%E4%BE%8B%E9%A1%B9%E7%9B%AE"><span class="toc-number">1.6.1.</span> <span class="toc-text">开源示例项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E6%8F%90%E6%9D%A1%E4%BB%B6"><span class="toc-number">1.6.2.</span> <span class="toc-text">前提条件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96-SDK"><span class="toc-number">1.6.3.</span> <span class="toc-text">获取 SDK</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%B3%95-1-%E4%BD%BF%E7%94%A8-npm-%E8%8E%B7%E5%8F%96-SDK"><span class="toc-number">1.6.3.1.</span> <span class="toc-text">方法 1. 使用 npm 获取 SDK</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%B3%95-2-%E4%BD%BF%E7%94%A8-CDN-%E6%96%B9%E6%B3%95%E8%8E%B7%E5%8F%96-SDK"><span class="toc-number">1.6.3.2.</span> <span class="toc-text">方法 2. 使用 CDN 方法获取 SDK</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%B3%95-3-%E6%89%8B%E5%8A%A8%E4%B8%8B%E8%BD%BD-SDK"><span class="toc-number">1.6.3.3.</span> <span class="toc-text">方法 3. 手动下载 SDK</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%AF%B9%E8%B1%A1"><span class="toc-number">1.6.4.</span> <span class="toc-text">常用对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%B5%81%E7%A8%8B"><span class="toc-number">1.6.5.</span> <span class="toc-text">基本流程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%88%9B%E5%BB%BA%E6%9C%AC%E5%9C%B0%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="toc-number">1.6.5.1.</span> <span class="toc-text">1. 创建本地客户端</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E8%AE%BE%E7%BD%AE%E7%94%A8%E6%88%B7%E8%A7%92%E8%89%B2"><span class="toc-number">1.6.5.2.</span> <span class="toc-text">2. 设置用户角色</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E5%8A%A0%E5%85%A5%E7%9B%AE%E6%A0%87%E9%A2%91%E9%81%93"><span class="toc-number">1.6.5.3.</span> <span class="toc-text">3. 加入目标频道</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E5%88%9B%E5%BB%BA%E5%B9%B6%E5%8F%91%E5%B8%83%E6%9C%AC%E5%9C%B0%E9%9F%B3%E8%A7%86%E9%A2%91%E8%BD%A8%E9%81%93"><span class="toc-number">1.6.5.4.</span> <span class="toc-text">4. 创建并发布本地音视频轨道</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E8%AE%A2%E9%98%85%E8%BF%9C%E7%AB%AF%E7%94%A8%E6%88%B7"><span class="toc-number">1.6.5.5.</span> <span class="toc-text">5. 订阅远端用户</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-%E7%A6%BB%E5%BC%80%E9%A2%91%E9%81%93"><span class="toc-number">1.6.5.6.</span> <span class="toc-text">6. 离开频道</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E4%BB%A3%E7%A0%81"><span class="toc-number">1.7.</span> <span class="toc-text">项目代码</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/andylin.github.io/2021/09/04/Vue%E6%A1%86%E6%9E%B6%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93/" title="Vue框架面试总结"><img src="/andylin.github.io/img/4.jpg" onerror="this.onerror=null;this.src='/andylin.github.io/img/404.jpg'" alt="Vue框架面试总结"/></a><div class="content"><a class="title" href="/andylin.github.io/2021/09/04/Vue%E6%A1%86%E6%9E%B6%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93/" title="Vue框架面试总结">Vue框架面试总结</a><time datetime="2021-09-04T15:39:19.000Z" title="发表于 2021-09-04 23:39:19">2021-09-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/andylin.github.io/2021/09/04/v-bind/" title="v-bind"><img src="/andylin.github.io/img/8.jpg" onerror="this.onerror=null;this.src='/andylin.github.io/img/404.jpg'" alt="v-bind"/></a><div class="content"><a class="title" href="/andylin.github.io/2021/09/04/v-bind/" title="v-bind">v-bind</a><time datetime="2021-09-04T12:04:21.000Z" title="发表于 2021-09-04 20:04:21">2021-09-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/andylin.github.io/2021/09/04/CSS%E5%8A%A8%E7%94%BB/" title="CSS动画"><img src="/andylin.github.io/img/11.jpg" onerror="this.onerror=null;this.src='/andylin.github.io/img/404.jpg'" alt="CSS动画"/></a><div class="content"><a class="title" href="/andylin.github.io/2021/09/04/CSS%E5%8A%A8%E7%94%BB/" title="CSS动画">CSS动画</a><time datetime="2021-09-04T08:42:38.000Z" title="发表于 2021-09-04 16:42:38">2021-09-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/andylin.github.io/2021/09/04/watch%E5%92%8Ccomputed/" title="watch和computed"><img src="/andylin.github.io/img/11.jpg" onerror="this.onerror=null;this.src='/andylin.github.io/img/404.jpg'" alt="watch和computed"/></a><div class="content"><a class="title" href="/andylin.github.io/2021/09/04/watch%E5%92%8Ccomputed/" title="watch和computed">watch和computed</a><time datetime="2021-09-04T07:31:54.000Z" title="发表于 2021-09-04 15:31:54">2021-09-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/andylin.github.io/2021/09/04/%E5%B1%9E%E6%80%A7%E9%80%89%E6%8B%A9%E5%99%A8/" title="属性选择器"><img src="/andylin.github.io/img/1.jpg" onerror="this.onerror=null;this.src='/andylin.github.io/img/404.jpg'" alt="属性选择器"/></a><div class="content"><a class="title" href="/andylin.github.io/2021/09/04/%E5%B1%9E%E6%80%A7%E9%80%89%E6%8B%A9%E5%99%A8/" title="属性选择器">属性选择器</a><time datetime="2021-09-04T06:36:46.000Z" title="发表于 2021-09-04 14:36:46">2021-09-04</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By 林文钦</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Hi, welcome to my <a target="_blank" rel="noopener" href="https://butterfly.js.org/">blog</a>!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/andylin.github.io/js/utils.js"></script><script src="/andylin.github.io/js/main.js"></script><div class="js-pjax"></div><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>